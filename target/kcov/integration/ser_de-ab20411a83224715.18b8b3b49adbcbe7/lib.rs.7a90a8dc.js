var data = {lines:[
{"lineNum":"    1","line":"#![deny(missing_docs)]","class":"linePartCov","hits":"3","order":"2069","possible_hits":"10",},
{"lineNum":"    2","line":"#![deny(non_upper_case_globals)]"},
{"lineNum":"    3","line":"#![deny(non_camel_case_types)]"},
{"lineNum":"    4","line":"#![deny(non_snake_case)]"},
{"lineNum":"    5","line":"#![deny(unused_mut)]"},
{"lineNum":"    6","line":""},
{"lineNum":"    7","line":"#![cfg_attr(feature = \"strict\", deny(warnings))]"},
{"lineNum":"    8","line":""},
{"lineNum":"    9","line":"//! This crate provides data structures to represent"},
{"lineNum":"   10","line":"//! [lightning BOLT11](https://github.com/lightningnetwork/lightning-rfc/blob/master/11-payment-encoding.md)"},
{"lineNum":"   11","line":"//! invoices and functions to create, encode and decode these. If you just want to use the standard"},
{"lineNum":"   12","line":"//! en-/decoding functionality this should get you started:"},
{"lineNum":"   13","line":"//!"},
{"lineNum":"   14","line":"//!   * For parsing use `str::parse::<Invoice>(&self)` (see the docs of `impl FromStr for Invoice`)"},
{"lineNum":"   15","line":"//!   * For constructing invoices use the `InvoiceBuilder`"},
{"lineNum":"   16","line":"//!   * For serializing invoices use the `Display`/`ToString` traits"},
{"lineNum":"   17","line":""},
{"lineNum":"   18","line":"extern crate bech32;"},
{"lineNum":"   19","line":"extern crate bitcoin_hashes;"},
{"lineNum":"   20","line":"extern crate num_traits;"},
{"lineNum":"   21","line":"extern crate secp256k1;"},
{"lineNum":"   22","line":""},
{"lineNum":"   23","line":"use bech32::u5;"},
{"lineNum":"   24","line":"use bitcoin_hashes::Hash;"},
{"lineNum":"   25","line":"use bitcoin_hashes::sha256;"},
{"lineNum":"   26","line":""},
{"lineNum":"   27","line":"use secp256k1::key::PublicKey;"},
{"lineNum":"   28","line":"use secp256k1::{Message, RecoverableSignature, Secp256k1};"},
{"lineNum":"   29","line":"use std::ops::Deref;"},
{"lineNum":"   30","line":""},
{"lineNum":"   31","line":"use std::iter::FilterMap;"},
{"lineNum":"   32","line":"use std::slice::Iter;"},
{"lineNum":"   33","line":"use std::time::{SystemTime, Duration, UNIX_EPOCH};"},
{"lineNum":"   34","line":""},
{"lineNum":"   35","line":"mod de;"},
{"lineNum":"   36","line":"mod ser;"},
{"lineNum":"   37","line":"mod tb;"},
{"lineNum":"   38","line":""},
{"lineNum":"   39","line":"pub use de::{ParseError, ParseOrSemanticError};"},
{"lineNum":"   40","line":""},
{"lineNum":"   41","line":""},
{"lineNum":"   42","line":"// TODO: fix before 2037 (see rust PR #55527)"},
{"lineNum":"   43","line":"/// Defines the maximum UNIX timestamp that can be represented as `SystemTime`. This is checked by"},
{"lineNum":"   44","line":"/// one of the unit tests, please run them."},
{"lineNum":"   45","line":"const SYSTEM_TIME_MAX_UNIX_TIMESTAMP: u64 = std::i32::MAX as u64;"},
{"lineNum":"   46","line":""},
{"lineNum":"   47","line":"/// Allow the expiry time to be up to one year. Since this reduces the range of possible timestamps"},
{"lineNum":"   48","line":"/// it should be rather low as long as we still have to support 32bit time representations"},
{"lineNum":"   49","line":"const MAX_EXPIRY_TIME: u64 = 60 * 60 * 24 * 356;"},
{"lineNum":"   50","line":""},
{"lineNum":"   51","line":"/// This function is used as a static assert for the size of `SystemTime`. If the crate fails to"},
{"lineNum":"   52","line":"/// compile due to it this indicates that your system uses unexpected bounds for `SystemTime`. You"},
{"lineNum":"   53","line":"/// can remove this functions and run the test `test_system_time_bounds_assumptions`. In any case,"},
{"lineNum":"   54","line":"/// please open an issue. If all tests pass you should be able to use this library safely by just"},
{"lineNum":"   55","line":"/// removing this function till we patch it accordingly."},
{"lineNum":"   56","line":"fn __system_time_size_check() {"},
{"lineNum":"   57","line":"\t// Use 2 * sizeof(u64) as expected size since the expected underlying implementation is storing"},
{"lineNum":"   58","line":"\t// a `Duration` since `SystemTime::UNIX_EPOCH`."},
{"lineNum":"   59","line":"\tunsafe { std::mem::transmute::<SystemTime, [u8; 16]>(UNIX_EPOCH); }"},
{"lineNum":"   60","line":"}"},
{"lineNum":"   61","line":""},
{"lineNum":"   62","line":""},
{"lineNum":"   63","line":"/// **Call this function on startup to ensure that all assumptions about the platform are valid.**"},
{"lineNum":"   64","line":"///"},
{"lineNum":"   65","line":"/// Unfortunately we have to make assumptions about the upper bounds of the `SystemTime` type on"},
{"lineNum":"   66","line":"/// your platform which we can\'t fully verify at compile time and which isn\'t part of it\'s contract."},
{"lineNum":"   67","line":"/// To our best knowledge our assumptions hold for all platforms officially supported by rust, but"},
{"lineNum":"   68","line":"/// since this check is fast we recommend to do it anyway."},
{"lineNum":"   69","line":"///"},
{"lineNum":"   70","line":"/// If this function fails this is considered a bug. Please open an issue describing your"},
{"lineNum":"   71","line":"/// platform and stating your current system time."},
{"lineNum":"   72","line":"///"},
{"lineNum":"   73","line":"/// # Panics"},
{"lineNum":"   74","line":"/// If the check fails this function panics. By calling this function on startup you ensure that"},
{"lineNum":"   75","line":"/// this wont happen at an arbitrary later point in time."},
{"lineNum":"   76","line":"pub fn check_platform() {"},
{"lineNum":"   77","line":"    use std::time::{Duration, SystemTime, UNIX_EPOCH};"},
{"lineNum":"   78","line":""},
{"lineNum":"   79","line":"    // The upper and lower bounds of `SystemTime` are not part of its public contract and are"},
{"lineNum":"   80","line":"    // platform specific. That\'s why we have to test if our assumptions regarding these bounds"},
{"lineNum":"   81","line":"    // hold on the target platform."},
{"lineNum":"   82","line":"    //"},
{"lineNum":"   83","line":"    // If this test fails on your platform, please don\'t use the library and open an issue"},
{"lineNum":"   84","line":"    // instead so we can resolve the situation. Currently this library is tested on:"},
{"lineNum":"   85","line":"    //   * Linux (64bit)"},
{"lineNum":"   86","line":"    let fail_date = UNIX_EPOCH + Duration::from_secs(SYSTEM_TIME_MAX_UNIX_TIMESTAMP);"},
{"lineNum":"   87","line":"    let year = Duration::from_secs(60 * 60 * 24 * 365);"},
{"lineNum":"   88","line":""},
{"lineNum":"   89","line":"    // Make sure that the library will keep working for another year"},
{"lineNum":"   90","line":"    assert!(fail_date.duration_since(SystemTime::now()).unwrap() > year);"},
{"lineNum":"   91","line":""},
{"lineNum":"   92","line":"    let max_ts = PositiveTimestamp::from_unix_timestamp("},
{"lineNum":"   93","line":"        SYSTEM_TIME_MAX_UNIX_TIMESTAMP - MAX_EXPIRY_TIME"},
{"lineNum":"   94","line":"    ).unwrap();"},
{"lineNum":"   95","line":"    let max_exp = ::ExpiryTime::from_seconds(MAX_EXPIRY_TIME).unwrap();"},
{"lineNum":"   96","line":""},
{"lineNum":"   97","line":"    assert_eq!("},
{"lineNum":"   98","line":"        (*max_ts.as_time() + *max_exp.as_duration()).duration_since(UNIX_EPOCH).unwrap().as_secs(),"},
{"lineNum":"   99","line":"        SYSTEM_TIME_MAX_UNIX_TIMESTAMP"},
{"lineNum":"  100","line":"    );"},
{"lineNum":"  101","line":"}"},
{"lineNum":"  102","line":""},
{"lineNum":"  103","line":""},
{"lineNum":"  104","line":"/// Builder for `Invoice`s. It\'s the most convenient and advised way to use this library. It ensures"},
{"lineNum":"  105","line":"/// that only a semantically and syntactically correct Invoice can be built using it."},
{"lineNum":"  106","line":"///"},
{"lineNum":"  107","line":"/// ```"},
{"lineNum":"  108","line":"/// extern crate secp256k1;"},
{"lineNum":"  109","line":"/// extern crate lightning_invoice;"},
{"lineNum":"  110","line":"/// extern crate bitcoin_hashes;"},
{"lineNum":"  111","line":"///"},
{"lineNum":"  112","line":"/// use bitcoin_hashes::Hash;"},
{"lineNum":"  113","line":"/// use bitcoin_hashes::sha256;"},
{"lineNum":"  114","line":"///"},
{"lineNum":"  115","line":"/// use secp256k1::Secp256k1;"},
{"lineNum":"  116","line":"/// use secp256k1::key::SecretKey;"},
{"lineNum":"  117","line":"///"},
{"lineNum":"  118","line":"/// use lightning_invoice::{Currency, InvoiceBuilder};"},
{"lineNum":"  119","line":"///"},
{"lineNum":"  120","line":"/// # fn main() {"},
{"lineNum":"  121","line":"/// let private_key = SecretKey::from_slice("},
{"lineNum":"  122","line":"///\t\t&["},
{"lineNum":"  123","line":"///\t\t\t0xe1, 0x26, 0xf6, 0x8f, 0x7e, 0xaf, 0xcc, 0x8b, 0x74, 0xf5, 0x4d, 0x26, 0x9f,"},
{"lineNum":"  124","line":"///\t\t\t0xe2, 0x06, 0xbe, 0x71, 0x50, 0x00, 0xf9, 0x4d, 0xac, 0x06, 0x7d, 0x1c, 0x04,"},
{"lineNum":"  125","line":"/// \t\t0xa8, 0xca, 0x3b, 0x2d, 0xb7, 0x34"},
{"lineNum":"  126","line":"/// \t][..]"},
{"lineNum":"  127","line":"///\t).unwrap();"},
{"lineNum":"  128","line":"///"},
{"lineNum":"  129","line":"/// let payment_hash = sha256::Hash::from_slice(&[0; 32][..]).unwrap();"},
{"lineNum":"  130","line":"///"},
{"lineNum":"  131","line":"/// let invoice = InvoiceBuilder::new(Currency::Bitcoin)"},
{"lineNum":"  132","line":"/// \t.description(\"Coins pls!\".into())"},
{"lineNum":"  133","line":"/// \t.payment_hash(payment_hash)"},
{"lineNum":"  134","line":"/// \t.current_timestamp()"},
{"lineNum":"  135","line":"/// \t.build_signed(|hash| {"},
{"lineNum":"  136","line":"/// \t\tSecp256k1::new().sign_recoverable(hash, &private_key)"},
{"lineNum":"  137","line":"/// \t})"},
{"lineNum":"  138","line":"/// \t.unwrap();"},
{"lineNum":"  139","line":"///"},
{"lineNum":"  140","line":"/// assert!(invoice.to_string().starts_with(\"lnbc1\"));"},
{"lineNum":"  141","line":"/// # }"},
{"lineNum":"  142","line":"/// ```"},
{"lineNum":"  143","line":"///"},
{"lineNum":"  144","line":"/// # Type parameters"},
{"lineNum":"  145","line":"/// The two parameters `D` and `H` signal if the builder already contains the correct amount of the"},
{"lineNum":"  146","line":"/// given field:"},
{"lineNum":"  147","line":"///  * `D`: exactly one `Description` or `DescriptionHash`"},
{"lineNum":"  148","line":"///  * `H`: exactly one `PaymentHash`"},
{"lineNum":"  149","line":"///  * `T`: the timestamp is set"},
{"lineNum":"  150","line":"#[derive(Eq, PartialEq, Debug, Clone)]"},
{"lineNum":"  151","line":"pub struct InvoiceBuilder<D: tb::Bool, H: tb::Bool, T: tb::Bool> {"},
{"lineNum":"  152","line":"\tcurrency: Currency,"},
{"lineNum":"  153","line":"\tamount: Option<u64>,"},
{"lineNum":"  154","line":"\tsi_prefix: Option<SiPrefix>,"},
{"lineNum":"  155","line":"\ttimestamp: Option<PositiveTimestamp>,"},
{"lineNum":"  156","line":"\ttagged_fields: Vec<TaggedField>,"},
{"lineNum":"  157","line":"\terror: Option<CreationError>,"},
{"lineNum":"  158","line":""},
{"lineNum":"  159","line":"\tphantom_d: std::marker::PhantomData<D>,"},
{"lineNum":"  160","line":"\tphantom_h: std::marker::PhantomData<H>,"},
{"lineNum":"  161","line":"\tphantom_t: std::marker::PhantomData<T>,"},
{"lineNum":"  162","line":"}"},
{"lineNum":"  163","line":""},
{"lineNum":"  164","line":"/// Represents a syntactically and semantically correct lightning BOLT11 invoice."},
{"lineNum":"  165","line":"///"},
{"lineNum":"  166","line":"/// There are three ways to construct an `Invoice`:"},
{"lineNum":"  167","line":"///  1. using `InvoiceBuilder`"},
{"lineNum":"  168","line":"///  2. using `Invoice::from_signed(SignedRawInvoice)`"},
{"lineNum":"  169","line":"///  3. using `str::parse::<Invoice>(&str)`"},
{"lineNum":"  170","line":"#[derive(Eq, PartialEq, Debug, Clone)]","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":"  171","line":"pub struct Invoice {"},
{"lineNum":"  172","line":"\tsigned_invoice: SignedRawInvoice,","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  173","line":"}"},
{"lineNum":"  174","line":""},
{"lineNum":"  175","line":"/// Represents the description of an invoice which has to be either a directly included string or"},
{"lineNum":"  176","line":"/// a hash of a description provided out of band."},
{"lineNum":"  177","line":"#[derive(Eq, PartialEq, Debug, Clone)]"},
{"lineNum":"  178","line":"pub enum InvoiceDescription<\'f> {"},
{"lineNum":"  179","line":"\t/// Reference to the directly supplied description in the invoice"},
{"lineNum":"  180","line":"\tDirect(&\'f Description),"},
{"lineNum":"  181","line":""},
{"lineNum":"  182","line":"\t/// Reference to the description\'s hash included in the invoice"},
{"lineNum":"  183","line":"\tHash(&\'f Sha256),"},
{"lineNum":"  184","line":"}"},
{"lineNum":"  185","line":""},
{"lineNum":"  186","line":"/// Represents a signed `RawInvoice` with cached hash. The signature is not checked and may be"},
{"lineNum":"  187","line":"/// invalid."},
{"lineNum":"  188","line":"///"},
{"lineNum":"  189","line":"/// # Invariants"},
{"lineNum":"  190","line":"/// The hash has to be either from the deserialized invoice or from the serialized `raw_invoice`."},
{"lineNum":"  191","line":"#[derive(Eq, PartialEq, Debug, Clone)]","class":"linePartCov","hits":"2","order":"3665","possible_hits":"7",},
{"lineNum":"  192","line":"pub struct SignedRawInvoice {"},
{"lineNum":"  193","line":"\t/// The rawInvoice that the signature belongs to"},
{"lineNum":"  194","line":"\traw_invoice: RawInvoice,","class":"linePartCov","hits":"3","order":"3666","possible_hits":"5",},
{"lineNum":"  195","line":""},
{"lineNum":"  196","line":"\t/// Hash of the `RawInvoice` that will be used to check the signature."},
{"lineNum":"  197","line":"\t///"},
{"lineNum":"  198","line":"\t/// * if the `SignedRawInvoice` was deserialized the hash is of from the original encoded form,"},
{"lineNum":"  199","line":"\t/// since it\'s not guaranteed that encoding it again will lead to the same result since integers"},
{"lineNum":"  200","line":"\t/// could have been encoded with leading zeroes etc."},
{"lineNum":"  201","line":"\t/// * if the `SignedRawInvoice` was constructed manually the hash will be the calculated hash"},
{"lineNum":"  202","line":"\t/// from the `RawInvoice`"},
{"lineNum":"  203","line":"\thash: [u8; 32],","class":"linePartCov","hits":"3","order":"3667","possible_hits":"6",},
{"lineNum":"  204","line":""},
{"lineNum":"  205","line":"\t/// signature of the payment request"},
{"lineNum":"  206","line":"\tsignature: Signature,","class":"linePartCov","hits":"4","order":"3668","possible_hits":"8",},
{"lineNum":"  207","line":"}"},
{"lineNum":"  208","line":""},
{"lineNum":"  209","line":"/// Represents an syntactically correct Invoice for a payment on the lightning network,"},
{"lineNum":"  210","line":"/// but without the signature information."},
{"lineNum":"  211","line":"/// De- and encoding should not lead to information loss but may lead to different hashes."},
{"lineNum":"  212","line":"///"},
{"lineNum":"  213","line":"/// For methods without docs see the corresponding methods in `Invoice`."},
{"lineNum":"  214","line":"#[derive(Eq, PartialEq, Debug, Clone)]","class":"linePartCov","hits":"2","order":"3669","possible_hits":"6",},
{"lineNum":"  215","line":"pub struct RawInvoice {"},
{"lineNum":"  216","line":"\t/// human readable part"},
{"lineNum":"  217","line":"\tpub hrp: RawHrp,","class":"linePartCov","hits":"3","order":"3670","possible_hits":"5",},
{"lineNum":"  218","line":""},
{"lineNum":"  219","line":"\t/// data part"},
{"lineNum":"  220","line":"\tpub data: RawDataPart,","class":"linePartCov","hits":"3","order":"3671","possible_hits":"6",},
{"lineNum":"  221","line":"}"},
{"lineNum":"  222","line":""},
{"lineNum":"  223","line":"/// Data of the `RawInvoice` that is encoded in the human readable part"},
{"lineNum":"  224","line":"#[derive(Eq, PartialEq, Debug, Clone)]","class":"linePartCov","hits":"2","order":"3672","possible_hits":"7",},
{"lineNum":"  225","line":"pub struct RawHrp {"},
{"lineNum":"  226","line":"\t/// The currency deferred from the 3rd and 4th character of the bech32 transaction"},
{"lineNum":"  227","line":"\tpub currency: Currency,","class":"linePartCov","hits":"3","order":"3673","possible_hits":"5",},
{"lineNum":"  228","line":""},
{"lineNum":"  229","line":"\t/// The amount that, multiplied by the SI prefix, has to be payed"},
{"lineNum":"  230","line":"\tpub raw_amount: Option<u64>,","class":"linePartCov","hits":"3","order":"3674","possible_hits":"6",},
{"lineNum":"  231","line":""},
{"lineNum":"  232","line":"\t/// SI prefix that gets multiplied with the `raw_amount`"},
{"lineNum":"  233","line":"\tpub si_prefix: Option<SiPrefix>,","class":"linePartCov","hits":"4","order":"3675","possible_hits":"8",},
{"lineNum":"  234","line":"}"},
{"lineNum":"  235","line":""},
{"lineNum":"  236","line":"/// Data of the `RawInvoice` that is encoded in the data part"},
{"lineNum":"  237","line":"#[derive(Eq, PartialEq, Debug, Clone)]","class":"linePartCov","hits":"2","order":"3677","possible_hits":"6",},
{"lineNum":"  238","line":"pub struct RawDataPart {"},
{"lineNum":"  239","line":"\t/// generation time of the invoice"},
{"lineNum":"  240","line":"\tpub timestamp: PositiveTimestamp,","class":"linePartCov","hits":"3","order":"3678","possible_hits":"5",},
{"lineNum":"  241","line":""},
{"lineNum":"  242","line":"\t/// tagged fields of the payment request"},
{"lineNum":"  243","line":"\tpub tagged_fields: Vec<RawTaggedField>,","class":"linePartCov","hits":"3","order":"3679","possible_hits":"6",},
{"lineNum":"  244","line":"}"},
{"lineNum":"  245","line":""},
{"lineNum":"  246","line":"/// A timestamp that refers to a date after 1 January 1970 which means its representation as UNIX"},
{"lineNum":"  247","line":"/// timestamp is positive."},
{"lineNum":"  248","line":"///"},
{"lineNum":"  249","line":"/// # Invariants"},
{"lineNum":"  250","line":"/// The UNIX timestamp representing the stored time has to be positive and small enough so that"},
{"lineNum":"  251","line":"/// a `EpiryTime` can be added to it without an overflow."},
{"lineNum":"  252","line":"#[derive(Eq, PartialEq, Debug, Clone)]","class":"linePartCov","hits":"2","order":"3680","possible_hits":"6",},
{"lineNum":"  253","line":"pub struct PositiveTimestamp(SystemTime);","class":"linePartCov","hits":"1","order":"3681","possible_hits":"3",},
{"lineNum":"  254","line":""},
{"lineNum":"  255","line":"/// SI prefixes for the human readable part"},
{"lineNum":"  256","line":"#[derive(Eq, PartialEq, Debug, Clone, Copy)]","class":"linePartCov","hits":"2","order":"5449","possible_hits":"4",},
{"lineNum":"  257","line":"pub enum SiPrefix {"},
{"lineNum":"  258","line":"\t/// 10^-3"},
{"lineNum":"  259","line":"\tMilli,"},
{"lineNum":"  260","line":"\t/// 10^-6"},
{"lineNum":"  261","line":"\tMicro,"},
{"lineNum":"  262","line":"\t/// 10^-9"},
{"lineNum":"  263","line":"\tNano,"},
{"lineNum":"  264","line":"\t/// 10^-12"},
{"lineNum":"  265","line":"\tPico,"},
{"lineNum":"  266","line":"}"},
{"lineNum":"  267","line":""},
{"lineNum":"  268","line":"impl SiPrefix {"},
{"lineNum":"  269","line":"\t/// Returns the multiplier to go from a BTC value to picoBTC implied by this SiPrefix."},
{"lineNum":"  270","line":"\t/// This is effectively 10^12 * the prefix multiplier"},
{"lineNum":"  271","line":"\tpub fn multiplier(&self) -> u64 {","class":"lineCov","hits":"1","order":"2709","possible_hits":"1",},
{"lineNum":"  272","line":"\t\tmatch *self {","class":"linePartCov","hits":"2","order":"2711","possible_hits":"3",},
{"lineNum":"  273","line":"\t\t\tSiPrefix::Milli => 1_000_000_000,","class":"lineCov","hits":"2","order":"2710","possible_hits":"2",},
{"lineNum":"  274","line":"\t\t\tSiPrefix::Micro => 1_000_000,","class":"lineCov","hits":"1","order":"2719","possible_hits":"1",},
{"lineNum":"  275","line":"\t\t\tSiPrefix::Nano => 1_000,","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  276","line":"\t\t\tSiPrefix::Pico => 1,","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  277","line":"\t\t}"},
{"lineNum":"  278","line":"\t}","class":"linePartCov","hits":"1","order":"2712","possible_hits":"3",},
{"lineNum":"  279","line":""},
{"lineNum":"  280","line":"\t/// Returns all enum variants of `SiPrefix` sorted in descending order of their associated"},
{"lineNum":"  281","line":"\t/// multiplier."},
{"lineNum":"  282","line":"\tpub fn values_desc() -> &\'static [SiPrefix] {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  283","line":"\t\tuse SiPrefix::*;"},
{"lineNum":"  284","line":"\t\tstatic VALUES: [SiPrefix; 4] = [Milli, Micro, Nano, Pico];"},
{"lineNum":"  285","line":"\t\t&VALUES"},
{"lineNum":"  286","line":"\t}","class":"linePartCov","hits":"1","order":"2699","possible_hits":"2",},
{"lineNum":"  287","line":"}"},
{"lineNum":"  288","line":""},
{"lineNum":"  289","line":"/// Enum representing the crypto currencies supported by this library"},
{"lineNum":"  290","line":"#[allow(missing_docs)]"},
{"lineNum":"  291","line":"#[derive(Eq, PartialEq, Debug, Clone)]","class":"linePartCov","hits":"2","order":"3676","possible_hits":"4",},
{"lineNum":"  292","line":"pub enum Currency {"},
{"lineNum":"  293","line":"\tBitcoin,"},
{"lineNum":"  294","line":"\tBitcoinTestnet,"},
{"lineNum":"  295","line":"}"},
{"lineNum":"  296","line":""},
{"lineNum":"  297","line":"/// Tagged field which may have an unknown tag"},
{"lineNum":"  298","line":"#[derive(Eq, PartialEq, Debug, Clone)]","class":"linePartCov","hits":"2","order":"3693","possible_hits":"9",},
{"lineNum":"  299","line":"pub enum RawTaggedField {"},
{"lineNum":"  300","line":"\t/// Parsed tagged field with known tag"},
{"lineNum":"  301","line":"\tKnownSemantics(TaggedField),","class":"linePartCov","hits":"1","order":"3694","possible_hits":"3",},
{"lineNum":"  302","line":"\t/// tagged field which was not parsed due to an unknown tag or undefined field semantics"},
{"lineNum":"  303","line":"\tUnknownSemantics(Vec<u5>),","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  304","line":"}"},
{"lineNum":"  305","line":""},
{"lineNum":"  306","line":"/// Tagged field with known tag"},
{"lineNum":"  307","line":"///"},
{"lineNum":"  308","line":"/// For descriptions of the enum values please refer to the enclosed type\'s docs."},
{"lineNum":"  309","line":"#[allow(missing_docs)]"},
{"lineNum":"  310","line":"#[derive(Eq, PartialEq, Debug, Clone)]","class":"linePartCov","hits":"2","order":"3695","possible_hits":"21",},
{"lineNum":"  311","line":"pub enum TaggedField {"},
{"lineNum":"  312","line":"\tPaymentHash(Sha256),","class":"linePartCov","hits":"1","order":"3696","possible_hits":"3",},
{"lineNum":"  313","line":"\tDescription(Description),","class":"linePartCov","hits":"1","order":"3702","possible_hits":"3",},
{"lineNum":"  314","line":"\tPayeePubKey(PayeePubKey),","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  315","line":"\tDescriptionHash(Sha256),","class":"linePartCov","hits":"1","order":"5458","possible_hits":"3",},
{"lineNum":"  316","line":"\tExpiryTime(ExpiryTime),","class":"linePartCov","hits":"1","order":"5450","possible_hits":"3",},
{"lineNum":"  317","line":"\tMinFinalCltvExpiry(MinFinalCltvExpiry),","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  318","line":"\tFallback(Fallback),","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  319","line":"\tRoute(Route),","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  320","line":"}"},
{"lineNum":"  321","line":""},
{"lineNum":"  322","line":"/// SHA-256 hash"},
{"lineNum":"  323","line":"#[derive(Eq, PartialEq, Debug, Clone)]","class":"linePartCov","hits":"2","order":"3697","possible_hits":"6",},
{"lineNum":"  324","line":"pub struct Sha256(pub sha256::Hash);","class":"linePartCov","hits":"1","order":"3698","possible_hits":"3",},
{"lineNum":"  325","line":""},
{"lineNum":"  326","line":"/// Description string"},
{"lineNum":"  327","line":"///"},
{"lineNum":"  328","line":"/// # Invariants"},
{"lineNum":"  329","line":"/// The description can be at most 639 __bytes__ long"},
{"lineNum":"  330","line":"#[derive(Eq, PartialEq, Debug, Clone)]","class":"linePartCov","hits":"2","order":"3703","possible_hits":"6",},
{"lineNum":"  331","line":"pub struct Description(String);","class":"linePartCov","hits":"1","order":"3704","possible_hits":"3",},
{"lineNum":"  332","line":""},
{"lineNum":"  333","line":"/// Payee public key"},
{"lineNum":"  334","line":"#[derive(Eq, PartialEq, Debug, Clone)]","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":"  335","line":"pub struct PayeePubKey(pub PublicKey);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  336","line":""},
{"lineNum":"  337","line":"/// Positive duration that defines when (relatively to the timestamp) in the future the invoice"},
{"lineNum":"  338","line":"/// expires"},
{"lineNum":"  339","line":"///"},
{"lineNum":"  340","line":"/// # Invariants"},
{"lineNum":"  341","line":"/// The number of seconds this expiry time represents has to be in the range"},
{"lineNum":"  342","line":"/// `0...(SYSTEM_TIME_MAX_UNIX_TIMESTAMP - MAX_EXPIRY_TIME)` to avoid overflows when adding it to a"},
{"lineNum":"  343","line":"/// timestamp"},
{"lineNum":"  344","line":"#[derive(Eq, PartialEq, Debug, Clone)]","class":"linePartCov","hits":"2","order":"5451","possible_hits":"6",},
{"lineNum":"  345","line":"pub struct ExpiryTime(Duration);","class":"linePartCov","hits":"1","order":"5452","possible_hits":"3",},
{"lineNum":"  346","line":""},
{"lineNum":"  347","line":"/// `min_final_cltv_expiry` to use for the last HTLC in the route"},
{"lineNum":"  348","line":"#[derive(Eq, PartialEq, Debug, Clone)]","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":"  349","line":"pub struct MinFinalCltvExpiry(pub u64);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  350","line":""},
{"lineNum":"  351","line":"// TODO: better types instead onf byte arrays"},
{"lineNum":"  352","line":"/// Fallback address in case no LN payment is possible"},
{"lineNum":"  353","line":"#[allow(missing_docs)]"},
{"lineNum":"  354","line":"#[derive(Eq, PartialEq, Debug, Clone)]","class":"lineNoCov","hits":"0","possible_hits":"14",},
{"lineNum":"  355","line":"pub enum Fallback {"},
{"lineNum":"  356","line":"\tSegWitProgram {"},
{"lineNum":"  357","line":"\t\tversion: u5,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":"  358","line":"\t\tprogram: Vec<u8>,","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":"  359","line":"\t},"},
{"lineNum":"  360","line":"\tPubKeyHash([u8; 20]),","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  361","line":"\tScriptHash([u8; 20]),","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  362","line":"}"},
{"lineNum":"  363","line":""},
{"lineNum":"  364","line":"/// Recoverable signature"},
{"lineNum":"  365","line":"#[derive(Eq, PartialEq, Debug, Clone)]","class":"linePartCov","hits":"2","order":"3707","possible_hits":"6",},
{"lineNum":"  366","line":"pub struct Signature(pub RecoverableSignature);","class":"linePartCov","hits":"1","order":"3708","possible_hits":"3",},
{"lineNum":"  367","line":""},
{"lineNum":"  368","line":"/// Private routing information"},
{"lineNum":"  369","line":"///"},
{"lineNum":"  370","line":"/// # Invariants"},
{"lineNum":"  371","line":"/// The encoded route has to be <1024 5bit characters long (<=639 bytes or <=12 hops)"},
{"lineNum":"  372","line":"///"},
{"lineNum":"  373","line":"#[derive(Eq, PartialEq, Debug, Clone)]","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":"  374","line":"pub struct Route(Vec<RouteHop>);","class":"lineNoCov","hits":"0","possible_hits":"3",},
{"lineNum":"  375","line":""},
{"lineNum":"  376","line":"/// Node on a private route"},
{"lineNum":"  377","line":"#[derive(Eq, PartialEq, Debug, Clone)]","class":"lineNoCov","hits":"0","possible_hits":"9",},
{"lineNum":"  378","line":"pub struct RouteHop {"},
{"lineNum":"  379","line":"\t/// Node\'s public key"},
{"lineNum":"  380","line":"\tpub pubkey: PublicKey,","class":"lineNoCov","hits":"0","possible_hits":"5",},
{"lineNum":"  381","line":""},
{"lineNum":"  382","line":"\t/// Which channel of this node we would be using"},
{"lineNum":"  383","line":"\tpub short_channel_id: [u8; 8],","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":"  384","line":""},
{"lineNum":"  385","line":"\t/// Fee charged by this node per transaction"},
{"lineNum":"  386","line":"\tpub fee_base_msat: u32,","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":"  387","line":""},
{"lineNum":"  388","line":"\t/// Fee charged by this node proportional to the amount routed"},
{"lineNum":"  389","line":"\tpub fee_proportional_millionths: u32,","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":"  390","line":""},
{"lineNum":"  391","line":"\t/// Delta substracted by this node from incoming cltv_expiry value"},
{"lineNum":"  392","line":"\tpub cltv_expiry_delta: u16,","class":"lineNoCov","hits":"0","possible_hits":"6",},
{"lineNum":"  393","line":"}"},
{"lineNum":"  394","line":""},
{"lineNum":"  395","line":"/// Tag constants as specified in BOLT11"},
{"lineNum":"  396","line":"#[allow(missing_docs)]"},
{"lineNum":"  397","line":"pub mod constants {"},
{"lineNum":"  398","line":"\tpub const TAG_PAYMENT_HASH: u8 = 1;"},
{"lineNum":"  399","line":"\tpub const TAG_DESCRIPTION: u8 = 13;"},
{"lineNum":"  400","line":"\tpub const TAG_PAYEE_PUB_KEY: u8 = 19;"},
{"lineNum":"  401","line":"\tpub const TAG_DESCRIPTION_HASH: u8 = 23;"},
{"lineNum":"  402","line":"\tpub const TAG_EXPIRY_TIME: u8 = 6;"},
{"lineNum":"  403","line":"\tpub const TAG_MIN_FINAL_CLTV_EXPIRY: u8 = 24;"},
{"lineNum":"  404","line":"\tpub const TAG_FALLBACK: u8 = 9;"},
{"lineNum":"  405","line":"\tpub const TAG_ROUTE: u8 = 3;"},
{"lineNum":"  406","line":"}"},
{"lineNum":"  407","line":""},
{"lineNum":"  408","line":"impl InvoiceBuilder<tb::False, tb::False, tb::False> {"},
{"lineNum":"  409","line":"\t/// Construct new, empty `InvoiceBuilder`. All necessary fields have to be filled first before"},
{"lineNum":"  410","line":"\t/// `InvoiceBuilder::build(self)` becomes available."},
{"lineNum":"  411","line":"\tpub fn new(currrency: Currency) -> Self {","class":"lineCov","hits":"1","order":"1645","possible_hits":"1",},
{"lineNum":"  412","line":"\t\tInvoiceBuilder {","class":"lineCov","hits":"1","order":"1669","possible_hits":"1",},
{"lineNum":"  413","line":"\t\t\tcurrency: currrency,","class":"lineCov","hits":"1","order":"1646","possible_hits":"1",},
{"lineNum":"  414","line":"\t\t\tamount: None,","class":"lineCov","hits":"1","order":"1647","possible_hits":"1",},
{"lineNum":"  415","line":"\t\t\tsi_prefix: None,","class":"lineCov","hits":"1","order":"1648","possible_hits":"1",},
{"lineNum":"  416","line":"\t\t\ttimestamp: None,","class":"lineCov","hits":"1","order":"1649","possible_hits":"1",},
{"lineNum":"  417","line":"\t\t\ttagged_fields: Vec::new(),","class":"lineCov","hits":"1","order":"1650","possible_hits":"1",},
{"lineNum":"  418","line":"\t\t\terror: None,","class":"lineCov","hits":"1","order":"1668","possible_hits":"1",},
{"lineNum":"  419","line":""},
{"lineNum":"  420","line":"\t\t\tphantom_d: std::marker::PhantomData,"},
{"lineNum":"  421","line":"\t\t\tphantom_h: std::marker::PhantomData,"},
{"lineNum":"  422","line":"\t\t\tphantom_t: std::marker::PhantomData,"},
{"lineNum":"  423","line":"\t\t}"},
{"lineNum":"  424","line":"\t}","class":"linePartCov","hits":"1","order":"1670","possible_hits":"2",},
{"lineNum":"  425","line":"}"},
{"lineNum":"  426","line":""},
{"lineNum":"  427","line":"impl<D: tb::Bool, H: tb::Bool, T: tb::Bool> InvoiceBuilder<D, H, T> {"},
{"lineNum":"  428","line":"\t/// Helper function to set the completeness flags."},
{"lineNum":"  429","line":"\tfn set_flags<DN: tb::Bool, HN: tb::Bool, TN: tb::Bool>(self) -> InvoiceBuilder<DN, HN, TN> {","class":"lineCov","hits":"3","order":"1695","possible_hits":"3",},
{"lineNum":"  430","line":"\t\tInvoiceBuilder::<DN, HN, TN> {","class":"lineCov","hits":"3","order":"1702","possible_hits":"3",},
{"lineNum":"  431","line":"\t\t\tcurrency: self.currency,","class":"lineCov","hits":"3","order":"1696","possible_hits":"3",},
{"lineNum":"  432","line":"\t\t\tamount: self.amount,","class":"lineCov","hits":"3","order":"1697","possible_hits":"3",},
{"lineNum":"  433","line":"\t\t\tsi_prefix: self.si_prefix,","class":"lineCov","hits":"3","order":"1698","possible_hits":"3",},
{"lineNum":"  434","line":"\t\t\ttimestamp: self.timestamp,","class":"lineCov","hits":"3","order":"1699","possible_hits":"3",},
{"lineNum":"  435","line":"\t\t\ttagged_fields: self.tagged_fields,","class":"lineCov","hits":"3","order":"1700","possible_hits":"3",},
{"lineNum":"  436","line":"\t\t\terror: self.error,","class":"lineCov","hits":"3","order":"1701","possible_hits":"3",},
{"lineNum":"  437","line":""},
{"lineNum":"  438","line":"\t\t\tphantom_d: std::marker::PhantomData,"},
{"lineNum":"  439","line":"\t\t\tphantom_h: std::marker::PhantomData,"},
{"lineNum":"  440","line":"\t\t\tphantom_t: std::marker::PhantomData,"},
{"lineNum":"  441","line":"\t\t}"},
{"lineNum":"  442","line":"\t}","class":"linePartCov","hits":"3","order":"1703","possible_hits":"6",},
{"lineNum":"  443","line":""},
{"lineNum":"  444","line":"\t/// Sets the amount in pico BTC. The optimal SI prefix is choosen automatically."},
{"lineNum":"  445","line":"\tpub fn amount_pico_btc(mut self, amount: u64) -> Self {","class":"linePartCov","hits":"1","order":"2697","possible_hits":"2",},
{"lineNum":"  446","line":"\t\tlet biggest_possible_si_prefix = SiPrefix::values_desc()","class":"lineCov","hits":"4","order":"2698","possible_hits":"4",},
{"lineNum":"  447","line":"\t\t\t.iter()"},
{"lineNum":"  448","line":"\t\t\t.find(|prefix| amount % prefix.multiplier() == 0)","class":"lineCov","hits":"3","order":"2700","possible_hits":"3",},
{"lineNum":"  449","line":"\t\t\t.expect(\"Pico should always match\");"},
{"lineNum":"  450","line":"\t\tself.amount = Some(amount / biggest_possible_si_prefix.multiplier());","class":"linePartCov","hits":"1","order":"2729","possible_hits":"2",},
{"lineNum":"  451","line":"\t\tself.si_prefix = Some(*biggest_possible_si_prefix);","class":"lineCov","hits":"1","order":"2730","possible_hits":"1",},
{"lineNum":"  452","line":"\t\tself","class":"lineCov","hits":"1","order":"2731","possible_hits":"1",},
{"lineNum":"  453","line":"\t}","class":"linePartCov","hits":"1","order":"2732","possible_hits":"2",},
{"lineNum":"  454","line":""},
{"lineNum":"  455","line":"\t/// Sets the payee\'s public key."},
{"lineNum":"  456","line":"\tpub fn payee_pub_key(mut self, pub_key: PublicKey) -> Self {"},
{"lineNum":"  457","line":"\t\tself.tagged_fields.push(TaggedField::PayeePubKey(PayeePubKey(pub_key)));"},
{"lineNum":"  458","line":"\t\tself"},
{"lineNum":"  459","line":"\t}"},
{"lineNum":"  460","line":""},
{"lineNum":"  461","line":"\t/// Sets the expiry time"},
{"lineNum":"  462","line":"\tpub fn expiry_time(mut self, expiry_time: Duration) -> Self {","class":"linePartCov","hits":"1","order":"2739","possible_hits":"2",},
{"lineNum":"  463","line":"        match ExpiryTime::from_duration(expiry_time) {","class":"lineCov","hits":"2","order":"2740","possible_hits":"2",},
{"lineNum":"  464","line":"            Ok(t) => self.tagged_fields.push(TaggedField::ExpiryTime(t)),","class":"lineCov","hits":"2","order":"2745","possible_hits":"2",},
{"lineNum":"  465","line":"            Err(e) => self.error = Some(e),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  466","line":"        };"},
{"lineNum":"  467","line":"\t\tself","class":"lineCov","hits":"1","order":"2746","possible_hits":"1",},
{"lineNum":"  468","line":"\t}","class":"linePartCov","hits":"1","order":"2747","possible_hits":"2",},
{"lineNum":"  469","line":""},
{"lineNum":"  470","line":"\t/// Sets `min_final_cltv_expiry`."},
{"lineNum":"  471","line":"\tpub fn min_final_cltv_expiry(mut self, min_final_cltv_expiry: u64) -> Self {"},
{"lineNum":"  472","line":"\t\tself.tagged_fields.push(TaggedField::MinFinalCltvExpiry(MinFinalCltvExpiry(min_final_cltv_expiry)));"},
{"lineNum":"  473","line":"\t\tself"},
{"lineNum":"  474","line":"\t}"},
{"lineNum":"  475","line":""},
{"lineNum":"  476","line":"\t/// Adds a fallback address."},
{"lineNum":"  477","line":"\tpub fn fallback(mut self, fallback: Fallback) -> Self {"},
{"lineNum":"  478","line":"\t\tself.tagged_fields.push(TaggedField::Fallback(fallback));"},
{"lineNum":"  479","line":"\t\tself"},
{"lineNum":"  480","line":"\t}"},
{"lineNum":"  481","line":""},
{"lineNum":"  482","line":"\t/// Adds a private route."},
{"lineNum":"  483","line":"\tpub fn route(mut self, route: Vec<RouteHop>) -> Self {"},
{"lineNum":"  484","line":"\t\tmatch Route::new(route) {"},
{"lineNum":"  485","line":"\t\t\tOk(r) => self.tagged_fields.push(TaggedField::Route(r)),"},
{"lineNum":"  486","line":"\t\t\tErr(e) => self.error = Some(e),"},
{"lineNum":"  487","line":"\t\t}"},
{"lineNum":"  488","line":"\t\tself"},
{"lineNum":"  489","line":"\t}"},
{"lineNum":"  490","line":"}"},
{"lineNum":"  491","line":""},
{"lineNum":"  492","line":"impl<D: tb::Bool, H: tb::Bool> InvoiceBuilder<D, H, tb::True> {"},
{"lineNum":"  493","line":"\t/// Builds a `RawInvoice` if no `CreationError` occurred while construction any of the fields."},
{"lineNum":"  494","line":"\tpub fn build_raw(self) -> Result<RawInvoice, CreationError> {","class":"linePartCov","hits":"1","order":"1943","possible_hits":"2",},
{"lineNum":"  495","line":""},
{"lineNum":"  496","line":"\t\t// If an error occurred at any time before, return it now"},
{"lineNum":"  497","line":"\t\tif let Some(e) = self.error {","class":"linePartCov","hits":"1","order":"1944","possible_hits":"2",},
{"lineNum":"  498","line":"\t\t\treturn Err(e);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  499","line":"\t\t}"},
{"lineNum":"  500","line":""},
{"lineNum":"  501","line":"\t\tlet hrp = RawHrp {","class":"lineCov","hits":"1","order":"1948","possible_hits":"1",},
{"lineNum":"  502","line":"\t\t\tcurrency: self.currency,","class":"lineCov","hits":"1","order":"1945","possible_hits":"1",},
{"lineNum":"  503","line":"\t\t\traw_amount: self.amount,","class":"lineCov","hits":"1","order":"1946","possible_hits":"1",},
{"lineNum":"  504","line":"\t\t\tsi_prefix: self.si_prefix,","class":"lineCov","hits":"1","order":"1947","possible_hits":"1",},
{"lineNum":"  505","line":"\t\t};"},
{"lineNum":"  506","line":""},
{"lineNum":"  507","line":"\t\tlet timestamp = self.timestamp.expect(\"ensured to be Some(t) by type T\");","class":"lineCov","hits":"1","order":"1949","possible_hits":"1",},
{"lineNum":"  508","line":""},
{"lineNum":"  509","line":"\t\tlet tagged_fields = self.tagged_fields.into_iter().map(|tf| {","class":"lineCov","hits":"2","order":"1952","possible_hits":"2",},
{"lineNum":"  510","line":"\t\t\tRawTaggedField::KnownSemantics(tf)","class":"lineCov","hits":"1","order":"2027","possible_hits":"1",},
{"lineNum":"  511","line":"\t\t}).collect::<Vec<_>>();","class":"linePartCov","hits":"1","order":"2028","possible_hits":"2",},
{"lineNum":"  512","line":""},
{"lineNum":"  513","line":"\t\tlet data = RawDataPart {","class":"lineCov","hits":"1","order":"2056","possible_hits":"1",},
{"lineNum":"  514","line":"\t\t\ttimestamp: timestamp,","class":"lineCov","hits":"1","order":"2054","possible_hits":"1",},
{"lineNum":"  515","line":"\t\t\ttagged_fields: tagged_fields,","class":"lineCov","hits":"1","order":"2055","possible_hits":"1",},
{"lineNum":"  516","line":"\t\t};"},
{"lineNum":"  517","line":""},
{"lineNum":"  518","line":"\t\tOk(RawInvoice {","class":"lineCov","hits":"1","order":"2059","possible_hits":"1",},
{"lineNum":"  519","line":"\t\t\thrp: hrp,","class":"lineCov","hits":"1","order":"2057","possible_hits":"1",},
{"lineNum":"  520","line":"\t\t\tdata: data,","class":"lineCov","hits":"1","order":"2058","possible_hits":"1",},
{"lineNum":"  521","line":"\t\t})"},
{"lineNum":"  522","line":"\t}","class":"linePartCov","hits":"1","order":"2060","possible_hits":"2",},
{"lineNum":"  523","line":"}"},
{"lineNum":"  524","line":""},
{"lineNum":"  525","line":"impl<H: tb::Bool, T: tb::Bool> InvoiceBuilder<tb::False, H, T> {"},
{"lineNum":"  526","line":"\t/// Set the description. This function is only available if no description (hash) was set."},
{"lineNum":"  527","line":"\tpub fn description(mut self, description: String) -> InvoiceBuilder<tb::True, H, T> {","class":"linePartCov","hits":"1","order":"1925","possible_hits":"2",},
{"lineNum":"  528","line":"\t\tmatch Description::new(description) {","class":"lineCov","hits":"2","order":"1926","possible_hits":"2",},
{"lineNum":"  529","line":"\t\t\tOk(d) => self.tagged_fields.push(TaggedField::Description(d)),","class":"lineCov","hits":"2","order":"1934","possible_hits":"2",},
{"lineNum":"  530","line":"\t\t\tErr(e) => self.error = Some(e),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  531","line":"\t\t}","class":"linePartCov","hits":"3","order":"1940","possible_hits":"4",},
{"lineNum":"  532","line":"\t\tself.set_flags()","class":"lineCov","hits":"1","order":"1941","possible_hits":"1",},
{"lineNum":"  533","line":"\t}","class":"linePartCov","hits":"1","order":"1942","possible_hits":"2",},
{"lineNum":"  534","line":""},
{"lineNum":"  535","line":"\t/// Set the description hash. This function is only available if no description (hash) was set."},
{"lineNum":"  536","line":"\tpub fn description_hash(mut self, description_hash: sha256::Hash) -> InvoiceBuilder<tb::True, H, T> {","class":"linePartCov","hits":"1","order":"2837","possible_hits":"2",},
{"lineNum":"  537","line":"\t\tself.tagged_fields.push(TaggedField::DescriptionHash(Sha256(description_hash)));","class":"lineCov","hits":"1","order":"2838","possible_hits":"1",},
{"lineNum":"  538","line":"\t\tself.set_flags()","class":"lineCov","hits":"1","order":"2839","possible_hits":"1",},
{"lineNum":"  539","line":"\t}","class":"lineCov","hits":"1","order":"2840","possible_hits":"1",},
{"lineNum":"  540","line":"}"},
{"lineNum":"  541","line":""},
{"lineNum":"  542","line":"impl<D: tb::Bool, T: tb::Bool> InvoiceBuilder<D, tb::False, T> {"},
{"lineNum":"  543","line":"\t/// Set the payment hash. This function is only available if no payment hash was set."},
{"lineNum":"  544","line":"\tpub fn payment_hash(mut self, hash: sha256::Hash) -> InvoiceBuilder<D, tb::True, T> {","class":"linePartCov","hits":"1","order":"1865","possible_hits":"2",},
{"lineNum":"  545","line":"\t\tself.tagged_fields.push(TaggedField::PaymentHash(Sha256(hash)));","class":"lineCov","hits":"1","order":"1866","possible_hits":"1",},
{"lineNum":"  546","line":"\t\tself.set_flags()","class":"lineCov","hits":"1","order":"1921","possible_hits":"1",},
{"lineNum":"  547","line":"\t}","class":"lineCov","hits":"1","order":"1922","possible_hits":"1",},
{"lineNum":"  548","line":"}"},
{"lineNum":"  549","line":""},
{"lineNum":"  550","line":"impl<D: tb::Bool, H: tb::Bool> InvoiceBuilder<D, H, tb::False> {"},
{"lineNum":"  551","line":"\t/// Sets the timestamp."},
{"lineNum":"  552","line":"\tpub fn timestamp(mut self, time: SystemTime) -> InvoiceBuilder<D, H, tb::True> {","class":"linePartCov","hits":"1","order":"1675","possible_hits":"2",},
{"lineNum":"  553","line":"\t\tmatch PositiveTimestamp::from_system_time(time) {","class":"lineCov","hits":"2","order":"1676","possible_hits":"2",},
{"lineNum":"  554","line":"\t\t\tOk(t) => self.timestamp = Some(t),","class":"lineCov","hits":"2","order":"1693","possible_hits":"2",},
{"lineNum":"  555","line":"\t\t\tErr(e) => self.error = Some(e),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  556","line":"\t\t}"},
{"lineNum":"  557","line":""},
{"lineNum":"  558","line":"\t\tself.set_flags()","class":"lineCov","hits":"1","order":"1694","possible_hits":"1",},
{"lineNum":"  559","line":"\t}","class":"linePartCov","hits":"1","order":"1704","possible_hits":"2",},
{"lineNum":"  560","line":""},
{"lineNum":"  561","line":"\t/// Sets the timestamp to the current UNIX timestamp."},
{"lineNum":"  562","line":"\tpub fn current_timestamp(mut self) -> InvoiceBuilder<D, H, tb::True> {"},
{"lineNum":"  563","line":"\t\tuse std::time::SystemTime;"},
{"lineNum":"  564","line":"\t\tlet now = PositiveTimestamp::from_system_time(SystemTime::now());"},
{"lineNum":"  565","line":"\t\tself.timestamp = Some(now.expect(\"for the foreseeable future this shouldn\'t happen\"));"},
{"lineNum":"  566","line":"\t\tself.set_flags()"},
{"lineNum":"  567","line":"\t}"},
{"lineNum":"  568","line":"}"},
{"lineNum":"  569","line":""},
{"lineNum":"  570","line":"impl InvoiceBuilder<tb::True, tb::True, tb::True> {"},
{"lineNum":"  571","line":"\t/// Builds and signs an invoice using the supplied `sign_function`. This function MAY NOT fail"},
{"lineNum":"  572","line":"\t/// and MUST produce a recoverable signature valid for the given hash and if applicable also for"},
{"lineNum":"  573","line":"\t/// the included payee public key."},
{"lineNum":"  574","line":"\tpub fn build_signed<F>(self, sign_function: F) -> Result<Invoice, CreationError>"},
{"lineNum":"  575","line":"\t\twhere F: FnOnce(&Message) -> RecoverableSignature"},
{"lineNum":"  576","line":"\t{"},
{"lineNum":"  577","line":"\t\tlet invoice = self.try_build_signed::<_, ()>(|hash| {"},
{"lineNum":"  578","line":"\t\t\tOk(sign_function(hash))"},
{"lineNum":"  579","line":"\t\t});"},
{"lineNum":"  580","line":""},
{"lineNum":"  581","line":"\t\tmatch invoice {"},
{"lineNum":"  582","line":"\t\t\tOk(i) => Ok(i),"},
{"lineNum":"  583","line":"\t\t\tErr(SignOrCreationError::CreationError(e)) => Err(e),"},
{"lineNum":"  584","line":"\t\t\tErr(SignOrCreationError::SignError(())) => unreachable!(),"},
{"lineNum":"  585","line":"\t\t}"},
{"lineNum":"  586","line":"\t}"},
{"lineNum":"  587","line":""},
{"lineNum":"  588","line":"\t/// Builds and signs an invoice using the supplied `sign_function`. This function MAY fail with"},
{"lineNum":"  589","line":"\t/// an error of type `E` and MUST produce a recoverable signature valid for the given hash and"},
{"lineNum":"  590","line":"\t/// if applicable also for the included payee public key."},
{"lineNum":"  591","line":"\tpub fn try_build_signed<F, E>(self, sign_function: F) -> Result<Invoice, SignOrCreationError<E>>"},
{"lineNum":"  592","line":"\t\twhere F: FnOnce(&Message) -> Result<RecoverableSignature, E>"},
{"lineNum":"  593","line":"\t{"},
{"lineNum":"  594","line":"\t\tlet raw = match self.build_raw() {"},
{"lineNum":"  595","line":"\t\t\tOk(r) => r,"},
{"lineNum":"  596","line":"\t\t\tErr(e) => return Err(SignOrCreationError::CreationError(e)),"},
{"lineNum":"  597","line":"\t\t};"},
{"lineNum":"  598","line":""},
{"lineNum":"  599","line":"\t\tlet signed = match raw.sign(sign_function) {"},
{"lineNum":"  600","line":"\t\t\tOk(s) => s,"},
{"lineNum":"  601","line":"\t\t\tErr(e) => return Err(SignOrCreationError::SignError(e)),"},
{"lineNum":"  602","line":"\t\t};"},
{"lineNum":"  603","line":""},
{"lineNum":"  604","line":"\t\tlet invoice = Invoice {"},
{"lineNum":"  605","line":"\t\t\tsigned_invoice: signed,"},
{"lineNum":"  606","line":"\t\t};"},
{"lineNum":"  607","line":""},
{"lineNum":"  608","line":"\t\tinvoice.check_field_counts().expect(\"should be ensured by type signature of builder\");"},
{"lineNum":"  609","line":""},
{"lineNum":"  610","line":"\t\tOk(invoice)"},
{"lineNum":"  611","line":"\t}"},
{"lineNum":"  612","line":"}"},
{"lineNum":"  613","line":""},
{"lineNum":"  614","line":""},
{"lineNum":"  615","line":"impl SignedRawInvoice {"},
{"lineNum":"  616","line":"\t/// Disassembles the `SignedRawInvoice` into its three parts:"},
{"lineNum":"  617","line":"\t///  1. raw invoice"},
{"lineNum":"  618","line":"\t///  2. hash of the raw invoice"},
{"lineNum":"  619","line":"\t///  3. signature"},
{"lineNum":"  620","line":"\tpub fn into_parts(self) -> (RawInvoice, [u8; 32], Signature) {"},
{"lineNum":"  621","line":"\t\t(self.raw_invoice, self.hash, self.signature)"},
{"lineNum":"  622","line":"\t}"},
{"lineNum":"  623","line":""},
{"lineNum":"  624","line":"\t/// The `RawInvoice` which was signed."},
{"lineNum":"  625","line":"\tpub fn raw_invoice(&self) -> &RawInvoice {","class":"lineCov","hits":"1","order":"3727","possible_hits":"1",},
{"lineNum":"  626","line":"\t\t&self.raw_invoice","class":"lineCov","hits":"1","order":"3728","possible_hits":"1",},
{"lineNum":"  627","line":"\t}","class":"linePartCov","hits":"1","order":"3729","possible_hits":"2",},
{"lineNum":"  628","line":""},
{"lineNum":"  629","line":"\t/// The hash of the `RawInvoice` that was signed."},
{"lineNum":"  630","line":"\tpub fn hash(&self) -> &[u8; 32] {"},
{"lineNum":"  631","line":"\t\t&self.hash"},
{"lineNum":"  632","line":"\t}"},
{"lineNum":"  633","line":""},
{"lineNum":"  634","line":"\t/// Signature for the invoice."},
{"lineNum":"  635","line":"\tpub fn signature(&self) -> &Signature {"},
{"lineNum":"  636","line":"\t\t&self.signature"},
{"lineNum":"  637","line":"\t}"},
{"lineNum":"  638","line":""},
{"lineNum":"  639","line":"\t/// Recovers the public key used for signing the invoice from the recoverable signature."},
{"lineNum":"  640","line":"\tpub fn recover_payee_pub_key(&self) -> Result<PayeePubKey, secp256k1::Error> {","class":"linePartCov","hits":"1","order":"3782","possible_hits":"2",},
{"lineNum":"  641","line":"\t\tlet hash = Message::from_slice(&self.hash[..])","class":"lineCov","hits":"2","order":"3783","possible_hits":"2",},
{"lineNum":"  642","line":"\t\t\t.expect(\"Hash is 32 bytes long, same as MESSAGE_SIZE\");"},
{"lineNum":"  643","line":""},
{"lineNum":"  644","line":"\t\tOk(PayeePubKey(Secp256k1::new().recover(","class":"linePartCov","hits":"3","order":"3784","possible_hits":"5",},
{"lineNum":"  645","line":"\t\t\t&hash,"},
{"lineNum":"  646","line":"\t\t\t&self.signature","class":"lineCov","hits":"1","order":"4748","possible_hits":"1",},
{"lineNum":"  647","line":"\t\t)?))"},
{"lineNum":"  648","line":"\t}","class":"linePartCov","hits":"1","order":"5218","possible_hits":"4",},
{"lineNum":"  649","line":""},
{"lineNum":"  650","line":"\t/// Checks if the signature is valid for the included payee public key or if none exists if it\'s"},
{"lineNum":"  651","line":"\t/// valid for the recovered signature (which should always be true?)."},
{"lineNum":"  652","line":"\tpub fn check_signature(&self) -> bool {","class":"linePartCov","hits":"1","order":"5242","possible_hits":"2",},
{"lineNum":"  653","line":"\t\tlet included_pub_key = self.raw_invoice.payee_pub_key();","class":"lineCov","hits":"1","order":"5243","possible_hits":"1",},
{"lineNum":"  654","line":""},
{"lineNum":"  655","line":"\t\tlet mut recovered_pub_key = Option::None;","class":"lineCov","hits":"1","order":"5264","possible_hits":"1",},
{"lineNum":"  656","line":"\t\tif recovered_pub_key.is_none() {","class":"lineCov","hits":"2","order":"5265","possible_hits":"2",},
{"lineNum":"  657","line":"\t\t\tlet recovered = match self.recover_payee_pub_key() {","class":"lineCov","hits":"1","order":"5267","possible_hits":"1",},
{"lineNum":"  658","line":"\t\t\t\tOk(pk) => pk,","class":"lineCov","hits":"2","order":"5268","possible_hits":"2",},
{"lineNum":"  659","line":"\t\t\t\tErr(_) => return false,","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  660","line":"\t\t\t};"},
{"lineNum":"  661","line":"\t\t\trecovered_pub_key = Some(recovered);","class":"lineCov","hits":"1","order":"5269","possible_hits":"1",},
{"lineNum":"  662","line":"\t\t}"},
{"lineNum":"  663","line":""},
{"lineNum":"  664","line":"\t\tlet pub_key = included_pub_key.or_else(|| recovered_pub_key.as_ref())","class":"lineCov","hits":"3","order":"5270","possible_hits":"3",},
{"lineNum":"  665","line":"\t\t\t.expect(\"One is always present\");"},
{"lineNum":"  666","line":""},
{"lineNum":"  667","line":"\t\tlet hash = Message::from_slice(&self.hash[..])","class":"lineCov","hits":"1","order":"5277","possible_hits":"1",},
{"lineNum":"  668","line":"\t\t\t.expect(\"Hash is 32 bytes long, same as MESSAGE_SIZE\");"},
{"lineNum":"  669","line":""},
{"lineNum":"  670","line":"\t\tlet secp_context = Secp256k1::new();","class":"lineCov","hits":"1","order":"5278","possible_hits":"1",},
{"lineNum":"  671","line":"\t\tlet verification_result = secp_context.verify(","class":"lineCov","hits":"1","order":"5304","possible_hits":"1",},
{"lineNum":"  672","line":"\t\t\t&hash,"},
{"lineNum":"  673","line":"\t\t\t&self.signature.to_standard(),","class":"lineCov","hits":"1","order":"5279","possible_hits":"1",},
{"lineNum":"  674","line":"\t\t\tpub_key","class":"lineCov","hits":"1","order":"5300","possible_hits":"1",},
{"lineNum":"  675","line":"\t\t);"},
{"lineNum":"  676","line":""},
{"lineNum":"  677","line":"\t\tmatch verification_result {","class":"lineCov","hits":"1","order":"5389","possible_hits":"1",},
{"lineNum":"  678","line":"\t\t\tOk(()) => true,","class":"lineCov","hits":"1","order":"5388","possible_hits":"1",},
{"lineNum":"  679","line":"\t\t\tErr(_) => false,","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  680","line":"\t\t}"},
{"lineNum":"  681","line":"\t}","class":"linePartCov","hits":"2","order":"5390","possible_hits":"4",},
{"lineNum":"  682","line":"}"},
{"lineNum":"  683","line":""},
{"lineNum":"  684","line":"/// Finds the first element of an enum stream of a given variant and extracts one member of the"},
{"lineNum":"  685","line":"/// variant. If no element was found `None` gets returned."},
{"lineNum":"  686","line":"///"},
{"lineNum":"  687","line":"/// The following example would extract the first"},
{"lineNum":"  688","line":"/// ```"},
{"lineNum":"  689","line":"/// use Enum::*"},
{"lineNum":"  690","line":"///"},
{"lineNum":"  691","line":"/// enum Enum {"},
{"lineNum":"  692","line":"/// \tA(u8),"},
{"lineNum":"  693","line":"/// \tB(u16)"},
{"lineNum":"  694","line":"/// }"},
{"lineNum":"  695","line":"///"},
{"lineNum":"  696","line":"/// let elements = vec![A(1), A(2), B(3), A(4)]"},
{"lineNum":"  697","line":"///"},
{"lineNum":"  698","line":"/// assert_eq!(find_extract!(elements.iter(), Enum::B(ref x), x), Some(3u16))"},
{"lineNum":"  699","line":"/// ```"},
{"lineNum":"  700","line":"macro_rules! find_extract {"},
{"lineNum":"  701","line":"    ($iter:expr, $enm:pat, $enm_var:ident) => {"},
{"lineNum":"  702","line":"    \t$iter.filter_map(|tf| match *tf {","class":"linePartCov","hits":"1","order":"5251","possible_hits":"2",},
{"lineNum":"  703","line":"\t\t\t$enm => Some($enm_var),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  704","line":"\t\t\t_ => None,","class":"lineCov","hits":"1","order":"5252","possible_hits":"1",},
{"lineNum":"  705","line":"\t\t}).next()","class":"linePartCov","hits":"1","order":"5253","possible_hits":"2",},
{"lineNum":"  706","line":"    };"},
{"lineNum":"  707","line":"}"},
{"lineNum":"  708","line":""},
{"lineNum":"  709","line":"#[allow(missing_docs)]"},
{"lineNum":"  710","line":"impl RawInvoice {"},
{"lineNum":"  711","line":"\t/// Hash the HRP as bytes and signatureless data part."},
{"lineNum":"  712","line":"\tfn hash_from_parts(hrp_bytes: &[u8], data_without_signature: &[u5]) -> [u8; 32] {","class":"linePartCov","hits":"1","order":"2328","possible_hits":"2",},
{"lineNum":"  713","line":"\t\tuse bech32::FromBase32;"},
{"lineNum":"  714","line":""},
{"lineNum":"  715","line":"\t\tlet mut preimage = Vec::<u8>::from(hrp_bytes);","class":"lineCov","hits":"1","order":"2329","possible_hits":"1",},
{"lineNum":"  716","line":""},
{"lineNum":"  717","line":"\t\tlet mut data_part = Vec::from(data_without_signature);","class":"lineCov","hits":"1","order":"2333","possible_hits":"1",},
{"lineNum":"  718","line":"\t\tlet overhang = (data_part.len() * 5) % 8;","class":"linePartCov","hits":"3","order":"2334","possible_hits":"4",},
{"lineNum":"  719","line":"\t\tif overhang > 0 {","class":"lineCov","hits":"2","order":"2335","possible_hits":"2",},
{"lineNum":"  720","line":"\t\t\t// add padding if data does not end at a byte boundary"},
{"lineNum":"  721","line":"\t\t\tdata_part.push(u5::try_from_u8(0).unwrap());","class":"lineCov","hits":"1","order":"2820","possible_hits":"1",},
{"lineNum":"  722","line":""},
{"lineNum":"  723","line":"\t\t\t// if overhang is in (1..3) we need to add u5(0) padding two times"},
{"lineNum":"  724","line":"\t\t\tif overhang < 3 {","class":"lineCov","hits":"2","order":"2821","possible_hits":"2",},
{"lineNum":"  725","line":"\t\t\t\tdata_part.push(u5::try_from_u8(0).unwrap());","class":"lineCov","hits":"1","order":"2822","possible_hits":"1",},
{"lineNum":"  726","line":"\t\t\t}"},
{"lineNum":"  727","line":"\t\t}"},
{"lineNum":"  728","line":""},
{"lineNum":"  729","line":"\t\tpreimage.extend_from_slice(&Vec::<u8>::from_base32(&data_part)","class":"lineCov","hits":"2","order":"2336","possible_hits":"2",},
{"lineNum":"  730","line":"\t\t\t.expect(\"No padding error may occur due to appended zero above.\"));","class":"linePartCov","hits":"1","order":"2344","possible_hits":"2",},
{"lineNum":"  731","line":""},
{"lineNum":"  732","line":"\t\tlet mut hash: [u8; 32] = Default::default();","class":"lineCov","hits":"1","order":"2345","possible_hits":"1",},
{"lineNum":"  733","line":"\t\thash.copy_from_slice(&sha256::Hash::hash(&preimage)[..]);","class":"lineCov","hits":"1","order":"2350","possible_hits":"1",},
{"lineNum":"  734","line":"\t\thash","class":"lineCov","hits":"1","order":"2593","possible_hits":"1",},
{"lineNum":"  735","line":"\t}","class":"linePartCov","hits":"1","order":"2594","possible_hits":"3",},
{"lineNum":"  736","line":""},
{"lineNum":"  737","line":"\t/// Calculate the hash of the encoded `RawInvoice`"},
{"lineNum":"  738","line":"\tpub fn hash(&self) -> [u8; 32] {","class":"linePartCov","hits":"1","order":"2063","possible_hits":"2",},
{"lineNum":"  739","line":"\t\tuse bech32::ToBase32;"},
{"lineNum":"  740","line":""},
{"lineNum":"  741","line":"\t\tRawInvoice::hash_from_parts(","class":"lineCov","hits":"1","order":"2327","possible_hits":"1",},
{"lineNum":"  742","line":"\t\t\tself.hrp.to_string().as_bytes(),","class":"lineCov","hits":"2","order":"2064","possible_hits":"2",},
{"lineNum":"  743","line":"\t\t\t&self.data.to_base32()","class":"lineCov","hits":"2","order":"2125","possible_hits":"2",},
{"lineNum":"  744","line":"\t\t)"},
{"lineNum":"  745","line":"\t}","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  746","line":""},
{"lineNum":"  747","line":"\t/// Signs the invoice using the supplied `sign_function`. This function MAY fail with an error"},
{"lineNum":"  748","line":"\t/// of type `E`. Since the signature of a `SignedRawInvoice` is not required to be valid there"},
{"lineNum":"  749","line":"\t/// are no constraints regarding the validity of the produced signature."},
{"lineNum":"  750","line":"\tpub fn sign<F, E>(self, sign_method: F) -> Result<SignedRawInvoice, E>","class":"linePartCov","hits":"3","order":"2061","possible_hits":"6",},
{"lineNum":"  751","line":"\t\twhere F: FnOnce(&Message) -> Result<RecoverableSignature, E>"},
{"lineNum":"  752","line":"\t{"},
{"lineNum":"  753","line":"\t\tlet raw_hash = self.hash();","class":"lineCov","hits":"3","order":"2062","possible_hits":"3",},
{"lineNum":"  754","line":"\t\tlet hash = Message::from_slice(&raw_hash[..])","class":"lineCov","hits":"6","order":"2595","possible_hits":"6",},
{"lineNum":"  755","line":"\t\t\t.expect(\"Hash is 32 bytes long, same as MESSAGE_SIZE\");"},
{"lineNum":"  756","line":"\t\tlet signature = sign_method(&hash)?;","class":"linePartCov","hits":"6","order":"2615","possible_hits":"15",},
{"lineNum":"  757","line":""},
{"lineNum":"  758","line":"\t\tOk(SignedRawInvoice {","class":"lineCov","hits":"3","order":"2691","possible_hits":"3",},
{"lineNum":"  759","line":"\t\t\traw_invoice: self,","class":"lineCov","hits":"3","order":"2688","possible_hits":"3",},
{"lineNum":"  760","line":"\t\t\thash: raw_hash,","class":"lineCov","hits":"3","order":"2689","possible_hits":"3",},
{"lineNum":"  761","line":"\t\t\tsignature: Signature(signature),","class":"lineCov","hits":"3","order":"2690","possible_hits":"3",},
{"lineNum":"  762","line":"\t\t})"},
{"lineNum":"  763","line":"\t}","class":"linePartCov","hits":"6","order":"2692","possible_hits":"15",},
{"lineNum":"  764","line":""},
{"lineNum":"  765","line":"\t/// Returns an iterator over all tagged fields with known semantics."},
{"lineNum":"  766","line":"\tpub fn known_tagged_fields(&self)","class":"lineCov","hits":"1","order":"3730","possible_hits":"1",},
{"lineNum":"  767","line":"\t\t-> FilterMap<Iter<RawTaggedField>, fn(&RawTaggedField) -> Option<&TaggedField>>"},
{"lineNum":"  768","line":"\t{"},
{"lineNum":"  769","line":"\t\t// For 1.14.0 compatibility: closures\' types can\'t be written an fn()->() in the"},
{"lineNum":"  770","line":"\t\t// function\'s type signature."},
{"lineNum":"  771","line":"\t\t// TODO: refactor once impl Trait is available"},
{"lineNum":"  772","line":"\t\tfn match_raw(raw: &RawTaggedField) -> Option<&TaggedField> {","class":"lineCov","hits":"1","order":"3757","possible_hits":"1",},
{"lineNum":"  773","line":"\t\t\tmatch *raw {","class":"lineCov","hits":"1","order":"3759","possible_hits":"1",},
{"lineNum":"  774","line":"\t\t\t\tRawTaggedField::KnownSemantics(ref tf) => Some(tf),","class":"lineCov","hits":"1","order":"3758","possible_hits":"1",},
{"lineNum":"  775","line":"\t\t\t\t_ => None,","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  776","line":"\t\t\t}"},
{"lineNum":"  777","line":"\t\t}","class":"linePartCov","hits":"1","order":"3760","possible_hits":"2",},
{"lineNum":"  778","line":""},
{"lineNum":"  779","line":"\t\tself.data.tagged_fields.iter().filter_map(match_raw )","class":"lineCov","hits":"1","order":"3731","possible_hits":"1",},
{"lineNum":"  780","line":"\t}","class":"linePartCov","hits":"1","order":"3738","possible_hits":"2",},
{"lineNum":"  781","line":""},
{"lineNum":"  782","line":"\tpub fn payment_hash(&self) -> Option<&Sha256> {"},
{"lineNum":"  783","line":"\t\tfind_extract!(self.known_tagged_fields(), TaggedField::PaymentHash(ref x), x)"},
{"lineNum":"  784","line":"\t}"},
{"lineNum":"  785","line":""},
{"lineNum":"  786","line":"\tpub fn description(&self) -> Option<&Description> {"},
{"lineNum":"  787","line":"\t\tfind_extract!(self.known_tagged_fields(), TaggedField::Description(ref x), x)"},
{"lineNum":"  788","line":"\t}"},
{"lineNum":"  789","line":""},
{"lineNum":"  790","line":"\tpub fn payee_pub_key(&self) -> Option<&PayeePubKey> {","class":"lineCov","hits":"1","order":"5244","possible_hits":"1",},
{"lineNum":"  791","line":"\t\tfind_extract!(self.known_tagged_fields(), TaggedField::PayeePubKey(ref x), x)","class":"lineCov","hits":"2","order":"5245","possible_hits":"2",},
{"lineNum":"  792","line":"\t}","class":"linePartCov","hits":"1","order":"5263","possible_hits":"2",},
{"lineNum":"  793","line":""},
{"lineNum":"  794","line":"\tpub fn description_hash(&self) -> Option<&Sha256> {"},
{"lineNum":"  795","line":"\t\tfind_extract!(self.known_tagged_fields(), TaggedField::DescriptionHash(ref x), x)"},
{"lineNum":"  796","line":"\t}"},
{"lineNum":"  797","line":""},
{"lineNum":"  798","line":"\tpub fn expiry_time(&self) -> Option<&ExpiryTime> {"},
{"lineNum":"  799","line":"\t\tfind_extract!(self.known_tagged_fields(), TaggedField::ExpiryTime(ref x), x)"},
{"lineNum":"  800","line":"\t}"},
{"lineNum":"  801","line":""},
{"lineNum":"  802","line":"\tpub fn min_final_cltv_expiry(&self) -> Option<&MinFinalCltvExpiry> {"},
{"lineNum":"  803","line":"\t\tfind_extract!(self.known_tagged_fields(), TaggedField::MinFinalCltvExpiry(ref x), x)"},
{"lineNum":"  804","line":"\t}"},
{"lineNum":"  805","line":""},
{"lineNum":"  806","line":"\tpub fn fallbacks(&self) -> Vec<&Fallback> {"},
{"lineNum":"  807","line":"\t\tself.known_tagged_fields().filter_map(|tf| match tf {"},
{"lineNum":"  808","line":"\t\t\t&TaggedField::Fallback(ref f) => Some(f),"},
{"lineNum":"  809","line":"\t\t\t_ => None,"},
{"lineNum":"  810","line":"\t\t}).collect::<Vec<&Fallback>>()"},
{"lineNum":"  811","line":"\t}"},
{"lineNum":"  812","line":""},
{"lineNum":"  813","line":"\tpub fn routes(&self) -> Vec<&Route> {"},
{"lineNum":"  814","line":"\t\tself.known_tagged_fields().filter_map(|tf| match tf {"},
{"lineNum":"  815","line":"\t\t\t&TaggedField::Route(ref r) => Some(r),"},
{"lineNum":"  816","line":"\t\t\t_ => None,"},
{"lineNum":"  817","line":"\t\t}).collect::<Vec<&Route>>()"},
{"lineNum":"  818","line":"\t}"},
{"lineNum":"  819","line":""},
{"lineNum":"  820","line":"\tpub fn amount_pico_btc(&self) -> Option<u64> {"},
{"lineNum":"  821","line":"\t\tself.hrp.raw_amount.map(|v| {"},
{"lineNum":"  822","line":"\t\t\tv * self.hrp.si_prefix.as_ref().map_or(1_000_000_000_000, |si| { si.multiplier() })"},
{"lineNum":"  823","line":"\t\t})"},
{"lineNum":"  824","line":"\t}"},
{"lineNum":"  825","line":""},
{"lineNum":"  826","line":"\tpub fn currency(&self) -> Currency {"},
{"lineNum":"  827","line":"\t\tself.hrp.currency.clone()"},
{"lineNum":"  828","line":"\t}"},
{"lineNum":"  829","line":"}"},
{"lineNum":"  830","line":""},
{"lineNum":"  831","line":"impl PositiveTimestamp {"},
{"lineNum":"  832","line":"\t/// Create a new `PositiveTimestamp` from a unix timestamp in the Range"},
{"lineNum":"  833","line":"\t/// `0...SYSTEM_TIME_MAX_UNIX_TIMESTAMP - MAX_EXPIRY_TIME`, otherwise return a"},
{"lineNum":"  834","line":"\t/// `CreationError::TimestampOutOfBounds`."},
{"lineNum":"  835","line":"\tpub fn from_unix_timestamp(unix_seconds: u64) -> Result<Self, CreationError> {","class":"lineCov","hits":"1","order":"3594","possible_hits":"1",},
{"lineNum":"  836","line":"\t\tif unix_seconds > SYSTEM_TIME_MAX_UNIX_TIMESTAMP - MAX_EXPIRY_TIME {","class":"linePartCov","hits":"1","order":"3595","possible_hits":"4",},
{"lineNum":"  837","line":"\t\t\tErr(CreationError::TimestampOutOfBounds)","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  838","line":"\t\t} else {"},
{"lineNum":"  839","line":"\t\t\tOk(PositiveTimestamp(UNIX_EPOCH + Duration::from_secs(unix_seconds)))","class":"lineCov","hits":"1","order":"3596","possible_hits":"1",},
{"lineNum":"  840","line":"\t\t}"},
{"lineNum":"  841","line":"\t}","class":"lineCov","hits":"1","order":"3597","possible_hits":"1",},
{"lineNum":"  842","line":""},
{"lineNum":"  843","line":"\t/// Create a new `PositiveTimestamp` from a `SystemTime` with a corresponding unix timestamp in"},
{"lineNum":"  844","line":"\t/// the Range `0...SYSTEM_TIME_MAX_UNIX_TIMESTAMP - MAX_EXPIRY_TIME`, otherwise return a"},
{"lineNum":"  845","line":"\t/// `CreationError::TimestampOutOfBounds`."},
{"lineNum":"  846","line":"\tpub fn from_system_time(time: SystemTime) -> Result<Self, CreationError> {","class":"lineCov","hits":"1","order":"1677","possible_hits":"1",},
{"lineNum":"  847","line":"\t\tif time","class":"lineCov","hits":"2","order":"1678","possible_hits":"2",},
{"lineNum":"  848","line":"\t\t\t.duration_since(UNIX_EPOCH)"},
{"lineNum":"  849","line":"\t\t\t.map(|t| t.as_secs() <= SYSTEM_TIME_MAX_UNIX_TIMESTAMP - MAX_EXPIRY_TIME)","class":"lineCov","hits":"2","order":"1684","possible_hits":"2",},
{"lineNum":"  850","line":"\t\t\t.unwrap_or(true)"},
{"lineNum":"  851","line":"\t\t\t{"},
{"lineNum":"  852","line":"\t\t\t\tOk(PositiveTimestamp(time))","class":"lineCov","hits":"1","order":"1691","possible_hits":"1",},
{"lineNum":"  853","line":"\t\t\t} else {"},
{"lineNum":"  854","line":"\t\t\tErr(CreationError::TimestampOutOfBounds)","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  855","line":"\t\t}"},
{"lineNum":"  856","line":"\t}","class":"linePartCov","hits":"1","order":"1692","possible_hits":"2",},
{"lineNum":"  857","line":""},
{"lineNum":"  858","line":"\t/// Returns the UNIX timestamp representing the stored time"},
{"lineNum":"  859","line":"\tpub fn as_unix_timestamp(&self) -> u64 {","class":"lineCov","hits":"1","order":"2131","possible_hits":"1",},
{"lineNum":"  860","line":"\t\tself.0.duration_since(UNIX_EPOCH)","class":"lineCov","hits":"1","order":"2132","possible_hits":"1",},
{"lineNum":"  861","line":"\t\t\t.expect(\"ensured by type contract/constructors\")"},
{"lineNum":"  862","line":"\t\t\t.as_secs()"},
{"lineNum":"  863","line":"\t}","class":"linePartCov","hits":"1","order":"2134","possible_hits":"2",},
{"lineNum":"  864","line":""},
{"lineNum":"  865","line":"\t/// Returns a reference to the internal `SystemTime` time representation"},
{"lineNum":"  866","line":"\tpub fn as_time(&self) -> &SystemTime {"},
{"lineNum":"  867","line":"\t\t&self.0"},
{"lineNum":"  868","line":"\t}"},
{"lineNum":"  869","line":"}"},
{"lineNum":"  870","line":""},
{"lineNum":"  871","line":"impl Into<SystemTime> for PositiveTimestamp {"},
{"lineNum":"  872","line":"\tfn into(self) -> SystemTime {"},
{"lineNum":"  873","line":"\t\tself.0"},
{"lineNum":"  874","line":"\t}"},
{"lineNum":"  875","line":"}"},
{"lineNum":"  876","line":""},
{"lineNum":"  877","line":"impl Deref for PositiveTimestamp {"},
{"lineNum":"  878","line":"\ttype Target = SystemTime;"},
{"lineNum":"  879","line":""},
{"lineNum":"  880","line":"\tfn deref(&self) -> &Self::Target {"},
{"lineNum":"  881","line":"\t\t&self.0"},
{"lineNum":"  882","line":"\t}"},
{"lineNum":"  883","line":"}"},
{"lineNum":"  884","line":""},
{"lineNum":"  885","line":"impl Invoice {"},
{"lineNum":"  886","line":"\t/// Transform the `Invoice` into it\'s unchecked version"},
{"lineNum":"  887","line":"\tpub fn into_signed_raw(self) -> SignedRawInvoice {"},
{"lineNum":"  888","line":"\t\tself.signed_invoice"},
{"lineNum":"  889","line":"\t}"},
{"lineNum":"  890","line":""},
{"lineNum":"  891","line":"\t/// Check that all mandatory fields are present"},
{"lineNum":"  892","line":"\tfn check_field_counts(&self) -> Result<(), SemanticError> {","class":"lineCov","hits":"1","order":"3723","possible_hits":"1",},
{"lineNum":"  893","line":"\t\t// \"A writer MUST include exactly one p field [].\""},
{"lineNum":"  894","line":"\t\tlet payment_hash_cnt = self.tagged_fields().filter(|&tf| match *tf {","class":"lineCov","hits":"4","order":"3724","possible_hits":"4",},
{"lineNum":"  895","line":"\t\t\tTaggedField::PaymentHash(_) => true,","class":"lineCov","hits":"1","order":"3762","possible_hits":"1",},
{"lineNum":"  896","line":"\t\t\t_ => false,","class":"lineCov","hits":"1","order":"3765","possible_hits":"1",},
{"lineNum":"  897","line":"\t\t}).count();","class":"linePartCov","hits":"1","order":"3763","possible_hits":"2",},
{"lineNum":"  898","line":"\t\tif payment_hash_cnt < 1 {","class":"lineCov","hits":"1","order":"3769","possible_hits":"1",},
{"lineNum":"  899","line":"\t\t\treturn Err(SemanticError::NoPaymentHash);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  900","line":"\t\t} else if payment_hash_cnt > 1 {","class":"lineCov","hits":"1","order":"3770","possible_hits":"1",},
{"lineNum":"  901","line":"\t\t\treturn Err(SemanticError::MultiplePaymentHashes);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  902","line":"\t\t}"},
{"lineNum":"  903","line":""},
{"lineNum":"  904","line":"\t\t// \"A writer MUST include either exactly one d or exactly one h field.\""},
{"lineNum":"  905","line":"\t\tlet description_cnt = self.tagged_fields().filter(|&tf| match *tf {","class":"lineCov","hits":"4","order":"3771","possible_hits":"4",},
{"lineNum":"  906","line":"\t\t\tTaggedField::Description(_) | TaggedField::DescriptionHash(_) => true,","class":"lineCov","hits":"1","order":"3772","possible_hits":"1",},
{"lineNum":"  907","line":"\t\t\t_ => false,","class":"lineCov","hits":"1","order":"3773","possible_hits":"1",},
{"lineNum":"  908","line":"\t\t}).count();","class":"linePartCov","hits":"1","order":"3774","possible_hits":"2",},
{"lineNum":"  909","line":"\t\tif  description_cnt < 1 {","class":"lineCov","hits":"1","order":"3775","possible_hits":"1",},
{"lineNum":"  910","line":"\t\t\treturn Err(SemanticError::NoDescription);","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":"  911","line":"\t\t} else if description_cnt > 1 {","class":"lineCov","hits":"1","order":"3776","possible_hits":"1",},
{"lineNum":"  912","line":"\t\t\treturn  Err(SemanticError::MultipleDescriptions);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  913","line":"\t\t}"},
{"lineNum":"  914","line":""},
{"lineNum":"  915","line":"\t\tOk(())","class":"lineCov","hits":"1","order":"3777","possible_hits":"1",},
{"lineNum":"  916","line":"\t}","class":"linePartCov","hits":"2","order":"3778","possible_hits":"3",},
{"lineNum":"  917","line":""},
{"lineNum":"  918","line":"\t/// Check that the invoice is signed correctly and that key recovery works"},
{"lineNum":"  919","line":"\tpub fn check_signature(&self) -> Result<(), SemanticError> {","class":"lineCov","hits":"1","order":"3780","possible_hits":"1",},
{"lineNum":"  920","line":"\t\tmatch self.signed_invoice.recover_payee_pub_key() {","class":"lineCov","hits":"1","order":"3781","possible_hits":"1",},
{"lineNum":"  921","line":"\t\t\tErr(secp256k1::Error::InvalidRecoveryId) =>","class":"linePartCov","hits":"1","order":"5240","possible_hits":"2",},
{"lineNum":"  922","line":"\t\t\t\treturn Err(SemanticError::InvalidRecoveryId),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  923","line":"\t\t\tErr(_) => panic!(\"no other error may occur\"),","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  924","line":"\t\t\tOk(_) => {},"},
{"lineNum":"  925","line":"\t\t}"},
{"lineNum":"  926","line":""},
{"lineNum":"  927","line":"\t\tif !self.signed_invoice.check_signature() {","class":"lineCov","hits":"1","order":"5241","possible_hits":"1",},
{"lineNum":"  928","line":"\t\t\treturn Err(SemanticError::InvalidSignature);","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":"  929","line":"\t\t}"},
{"lineNum":"  930","line":""},
{"lineNum":"  931","line":"\t\tOk(())","class":"lineCov","hits":"1","order":"5391","possible_hits":"1",},
{"lineNum":"  932","line":"\t}","class":"linePartCov","hits":"1","order":"5392","possible_hits":"3",},
{"lineNum":"  933","line":""},
{"lineNum":"  934","line":"\t/// Constructs an `Invoice` from a `SignedInvoice` by checking all its invariants."},
{"lineNum":"  935","line":"\t/// ```"},
{"lineNum":"  936","line":"\t/// use lightning_invoice::*;"},
{"lineNum":"  937","line":"\t///"},
{"lineNum":"  938","line":"\t/// let invoice = \"lnbc1pvjluezpp5qqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqqqsyqcyq5rqwzqfqypqdp\\"},
{"lineNum":"  939","line":"\t/// \tl2pkx2ctnv5sxxmmwwd5kgetjypeh2ursdae8g6twvus8g6rfwvs8qun0dfjkxaq8rkx3yf5tcsyz3d7\\"},
{"lineNum":"  940","line":"\t/// \t3gafnh3cax9rn449d9p5uxz9ezhhypd0elx87sjle52x86fux2ypatgddc6k63n7erqz25le42c4u4ec\\"},
{"lineNum":"  941","line":"\t/// \tky03ylcqca784w\";"},
{"lineNum":"  942","line":"\t///"},
{"lineNum":"  943","line":"\t/// let signed = invoice.parse::<SignedRawInvoice>().unwrap();"},
{"lineNum":"  944","line":"\t///"},
{"lineNum":"  945","line":"\t/// assert!(Invoice::from_signed(signed).is_ok());"},
{"lineNum":"  946","line":"\t/// ```"},
{"lineNum":"  947","line":"\tpub fn from_signed(signed_invoice: SignedRawInvoice) -> Result<Self, SemanticError> {","class":"linePartCov","hits":"1","order":"3719","possible_hits":"2",},
{"lineNum":"  948","line":"\t\tlet invoice = Invoice {","class":"lineCov","hits":"1","order":"3721","possible_hits":"1",},
{"lineNum":"  949","line":"\t\t\tsigned_invoice: signed_invoice,","class":"lineCov","hits":"1","order":"3720","possible_hits":"1",},
{"lineNum":"  950","line":"\t\t};"},
{"lineNum":"  951","line":"\t\tinvoice.check_field_counts()?;","class":"linePartCov","hits":"3","order":"3722","possible_hits":"4",},
{"lineNum":"  952","line":"\t\tinvoice.check_signature()?;","class":"lineCov","hits":"1","order":"3779","possible_hits":"1",},
{"lineNum":"  953","line":""},
{"lineNum":"  954","line":"\t\tOk(invoice)","class":"lineCov","hits":"1","order":"5393","possible_hits":"1",},
{"lineNum":"  955","line":"\t}","class":"linePartCov","hits":"2","order":"5394","possible_hits":"4",},
{"lineNum":"  956","line":""},
{"lineNum":"  957","line":"\t/// Returns the `Invoice`\'s timestamp (should equal it\'s creation time)"},
{"lineNum":"  958","line":"\tpub fn timestamp(&self) -> &SystemTime {"},
{"lineNum":"  959","line":"\t\tself.signed_invoice.raw_invoice().data.timestamp.as_time()"},
{"lineNum":"  960","line":"\t}"},
{"lineNum":"  961","line":""},
{"lineNum":"  962","line":"\t/// Returns an iterator over all tagged fields of this Invoice."},
{"lineNum":"  963","line":"\tpub fn tagged_fields(&self)","class":"lineCov","hits":"1","order":"3725","possible_hits":"1",},
{"lineNum":"  964","line":"\t\t-> FilterMap<Iter<RawTaggedField>, fn(&RawTaggedField) -> Option<&TaggedField>> {"},
{"lineNum":"  965","line":"\t\tself.signed_invoice.raw_invoice().known_tagged_fields()","class":"lineCov","hits":"1","order":"3726","possible_hits":"1",},
{"lineNum":"  966","line":"\t}","class":"linePartCov","hits":"1","order":"3739","possible_hits":"2",},
{"lineNum":"  967","line":""},
{"lineNum":"  968","line":"\t/// Returns the hash to which we will receive the preimage on completion of the payment"},
{"lineNum":"  969","line":"\tpub fn payment_hash(&self) -> &sha256::Hash {"},
{"lineNum":"  970","line":"\t\t&self.signed_invoice.payment_hash().expect(\"checked by constructor\").0"},
{"lineNum":"  971","line":"\t}"},
{"lineNum":"  972","line":""},
{"lineNum":"  973","line":"\t/// Return the description or a hash of it for longer ones"},
{"lineNum":"  974","line":"\tpub fn description(&self) -> InvoiceDescription {"},
{"lineNum":"  975","line":"\t\tif let Some(ref direct) = self.signed_invoice.description() {"},
{"lineNum":"  976","line":"\t\t\treturn InvoiceDescription::Direct(direct);"},
{"lineNum":"  977","line":"\t\t} else if let Some(ref hash) = self.signed_invoice.description_hash() {"},
{"lineNum":"  978","line":"\t\t\treturn InvoiceDescription::Hash(hash);"},
{"lineNum":"  979","line":"\t\t}"},
{"lineNum":"  980","line":"\t\tunreachable!(\"ensured by constructor\");"},
{"lineNum":"  981","line":"\t}"},
{"lineNum":"  982","line":""},
{"lineNum":"  983","line":"\t/// Get the payee\'s public key if one was included in the invoice"},
{"lineNum":"  984","line":"\tpub fn payee_pub_key(&self) -> Option<&PublicKey> {"},
{"lineNum":"  985","line":"\t\tself.signed_invoice.payee_pub_key().map(|x| &x.0)"},
{"lineNum":"  986","line":"\t}"},
{"lineNum":"  987","line":""},
{"lineNum":"  988","line":"\t/// Recover the payee\'s public key (only to be used if none was included in the invoice)"},
{"lineNum":"  989","line":"\tpub fn recover_payee_pub_key(&self) -> PublicKey {"},
{"lineNum":"  990","line":"\t\tself.signed_invoice.recover_payee_pub_key().expect(\"was checked by constructor\").0"},
{"lineNum":"  991","line":"\t}"},
{"lineNum":"  992","line":""},
{"lineNum":"  993","line":"\t/// Returns the invoice\'s expiry time if present"},
{"lineNum":"  994","line":"\tpub fn expiry_time(&self) -> Option<&Duration> {"},
{"lineNum":"  995","line":"\t\tself.signed_invoice.expiry_time().map(|x| &x.0)"},
{"lineNum":"  996","line":"\t}"},
{"lineNum":"  997","line":""},
{"lineNum":"  998","line":"\t/// Returns the invoice\'s `min_cltv_expiry` time if present"},
{"lineNum":"  999","line":"\tpub fn min_final_cltv_expiry(&self) -> Option<&u64> {"},
{"lineNum":" 1000","line":"\t\tself.signed_invoice.min_final_cltv_expiry().map(|x| &x.0)"},
{"lineNum":" 1001","line":"\t}"},
{"lineNum":" 1002","line":""},
{"lineNum":" 1003","line":"\t/// Returns a list of all fallback addresses"},
{"lineNum":" 1004","line":"\tpub fn fallbacks(&self) -> Vec<&Fallback> {"},
{"lineNum":" 1005","line":"\t\tself.signed_invoice.fallbacks()"},
{"lineNum":" 1006","line":"\t}"},
{"lineNum":" 1007","line":""},
{"lineNum":" 1008","line":"\t/// Returns a list of all routes included in the invoice"},
{"lineNum":" 1009","line":"\tpub fn routes(&self) -> Vec<&Route> {"},
{"lineNum":" 1010","line":"\t\tself.signed_invoice.routes()"},
{"lineNum":" 1011","line":"\t}"},
{"lineNum":" 1012","line":""},
{"lineNum":" 1013","line":"\t/// Returns the currency for which the invoice was issued"},
{"lineNum":" 1014","line":"\tpub fn currency(&self) -> Currency {"},
{"lineNum":" 1015","line":"\t\tself.signed_invoice.currency()"},
{"lineNum":" 1016","line":"\t}"},
{"lineNum":" 1017","line":""},
{"lineNum":" 1018","line":"\t/// Returns the amount if specified in the invoice as pico <currency>."},
{"lineNum":" 1019","line":"\tpub fn amount_pico_btc(&self) -> Option<u64> {"},
{"lineNum":" 1020","line":"\t\tself.signed_invoice.amount_pico_btc()"},
{"lineNum":" 1021","line":"\t}"},
{"lineNum":" 1022","line":"}"},
{"lineNum":" 1023","line":""},
{"lineNum":" 1024","line":"impl From<TaggedField> for RawTaggedField {"},
{"lineNum":" 1025","line":"\tfn from(tf: TaggedField) -> Self {"},
{"lineNum":" 1026","line":"\t\tRawTaggedField::KnownSemantics(tf)"},
{"lineNum":" 1027","line":"\t}"},
{"lineNum":" 1028","line":"}"},
{"lineNum":" 1029","line":""},
{"lineNum":" 1030","line":"impl TaggedField {"},
{"lineNum":" 1031","line":"\t/// Numeric representation of the field\'s tag"},
{"lineNum":" 1032","line":"\tpub fn tag(&self) -> u5 {"},
{"lineNum":" 1033","line":"\t\tlet tag = match *self {"},
{"lineNum":" 1034","line":"\t\t\tTaggedField::PaymentHash(_) => constants::TAG_PAYMENT_HASH,"},
{"lineNum":" 1035","line":"\t\t\tTaggedField::Description(_) => constants::TAG_DESCRIPTION,"},
{"lineNum":" 1036","line":"\t\t\tTaggedField::PayeePubKey(_) => constants::TAG_PAYEE_PUB_KEY,"},
{"lineNum":" 1037","line":"\t\t\tTaggedField::DescriptionHash(_) => constants::TAG_DESCRIPTION_HASH,"},
{"lineNum":" 1038","line":"\t\t\tTaggedField::ExpiryTime(_) => constants::TAG_EXPIRY_TIME,"},
{"lineNum":" 1039","line":"\t\t\tTaggedField::MinFinalCltvExpiry(_) => constants::TAG_MIN_FINAL_CLTV_EXPIRY,"},
{"lineNum":" 1040","line":"\t\t\tTaggedField::Fallback(_) => constants::TAG_FALLBACK,"},
{"lineNum":" 1041","line":"\t\t\tTaggedField::Route(_) => constants::TAG_ROUTE,"},
{"lineNum":" 1042","line":"\t\t};"},
{"lineNum":" 1043","line":""},
{"lineNum":" 1044","line":"\t\tu5::try_from_u8(tag).expect(\"all tags defined are <32\")"},
{"lineNum":" 1045","line":"\t}"},
{"lineNum":" 1046","line":"}"},
{"lineNum":" 1047","line":""},
{"lineNum":" 1048","line":"impl Description {"},
{"lineNum":" 1049","line":""},
{"lineNum":" 1050","line":"\t/// Creates a new `Description` if `description` is at most 1023 __bytes__ long,"},
{"lineNum":" 1051","line":"\t/// returns `CreationError::DescriptionTooLong` otherwise"},
{"lineNum":" 1052","line":"\t///"},
{"lineNum":" 1053","line":"\t/// Please note that single characters may use more than one byte due to UTF8 encoding."},
{"lineNum":" 1054","line":"\tpub fn new(description: String) -> Result<Description, CreationError> {","class":"linePartCov","hits":"1","order":"1927","possible_hits":"2",},
{"lineNum":" 1055","line":"\t\tif description.len() > 639 {","class":"linePartCov","hits":"2","order":"1928","possible_hits":"3",},
{"lineNum":" 1056","line":"\t\t\tErr(CreationError::DescriptionTooLong)","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1057","line":"\t\t} else {"},
{"lineNum":" 1058","line":"\t\t\tOk(Description(description))","class":"lineCov","hits":"1","order":"1932","possible_hits":"1",},
{"lineNum":" 1059","line":"\t\t}"},
{"lineNum":" 1060","line":"\t}","class":"linePartCov","hits":"1","order":"1933","possible_hits":"2",},
{"lineNum":" 1061","line":""},
{"lineNum":" 1062","line":"\t/// Returns the underlying description `String`"},
{"lineNum":" 1063","line":"\tpub fn into_inner(self) -> String {"},
{"lineNum":" 1064","line":"\t\tself.0"},
{"lineNum":" 1065","line":"\t}"},
{"lineNum":" 1066","line":"}"},
{"lineNum":" 1067","line":""},
{"lineNum":" 1068","line":"impl Into<String> for Description {"},
{"lineNum":" 1069","line":"\tfn into(self) -> String {"},
{"lineNum":" 1070","line":"\t\tself.into_inner()"},
{"lineNum":" 1071","line":"\t}"},
{"lineNum":" 1072","line":"}"},
{"lineNum":" 1073","line":""},
{"lineNum":" 1074","line":"impl Deref for Description {"},
{"lineNum":" 1075","line":"\ttype Target = str;"},
{"lineNum":" 1076","line":""},
{"lineNum":" 1077","line":"\tfn deref(&self) -> &str {","class":"lineCov","hits":"1","order":"2321","possible_hits":"1",},
{"lineNum":" 1078","line":"\t\t&self.0","class":"lineCov","hits":"1","order":"2322","possible_hits":"1",},
{"lineNum":" 1079","line":"\t}","class":"linePartCov","hits":"1","order":"2323","possible_hits":"2",},
{"lineNum":" 1080","line":"}"},
{"lineNum":" 1081","line":""},
{"lineNum":" 1082","line":"impl From<PublicKey> for PayeePubKey {"},
{"lineNum":" 1083","line":"\tfn from(pk: PublicKey) -> Self {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1084","line":"\t\tPayeePubKey(pk)","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1085","line":"\t}","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1086","line":"}"},
{"lineNum":" 1087","line":""},
{"lineNum":" 1088","line":"impl Deref for PayeePubKey {"},
{"lineNum":" 1089","line":"\ttype Target = PublicKey;"},
{"lineNum":" 1090","line":""},
{"lineNum":" 1091","line":"\tfn deref(&self) -> &PublicKey {","class":"lineCov","hits":"1","order":"5301","possible_hits":"1",},
{"lineNum":" 1092","line":"\t\t&self.0","class":"lineCov","hits":"1","order":"5302","possible_hits":"1",},
{"lineNum":" 1093","line":"\t}","class":"linePartCov","hits":"1","order":"5303","possible_hits":"2",},
{"lineNum":" 1094","line":"}"},
{"lineNum":" 1095","line":""},
{"lineNum":" 1096","line":"impl ExpiryTime {"},
{"lineNum":" 1097","line":"\t/// Construct an `ExpiryTime` from seconds. If there exists a `PositiveTimestamp` which would"},
{"lineNum":" 1098","line":"\t/// overflow on adding the `EpiryTime` to it then this function will return a"},
{"lineNum":" 1099","line":"\t/// `CreationError::ExpiryTimeOutOfBounds`."},
{"lineNum":" 1100","line":"\tpub fn from_seconds(seconds: u64) -> Result<ExpiryTime, CreationError> {","class":"lineCov","hits":"1","order":"5440","possible_hits":"1",},
{"lineNum":" 1101","line":"\t\tif seconds <= MAX_EXPIRY_TIME {","class":"linePartCov","hits":"1","order":"5441","possible_hits":"2",},
{"lineNum":" 1102","line":"\t\t\tOk(ExpiryTime(Duration::from_secs(seconds)))","class":"lineCov","hits":"2","order":"5442","possible_hits":"2",},
{"lineNum":" 1103","line":"\t\t} else {"},
{"lineNum":" 1104","line":"\t\t\tErr(CreationError::ExpiryTimeOutOfBounds)","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1105","line":"\t\t}"},
{"lineNum":" 1106","line":"\t}","class":"linePartCov","hits":"1","order":"5443","possible_hits":"2",},
{"lineNum":" 1107","line":""},
{"lineNum":" 1108","line":"\t/// Construct an `ExpiryTime` from a `Duration`. If there exists a `PositiveTimestamp` which"},
{"lineNum":" 1109","line":"\t/// would overflow on adding the `EpiryTime` to it then this function will return a"},
{"lineNum":" 1110","line":"\t/// `CreationError::ExpiryTimeOutOfBounds`."},
{"lineNum":" 1111","line":"\tpub fn from_duration(duration: Duration) -> Result<ExpiryTime, CreationError> {","class":"lineCov","hits":"1","order":"2741","possible_hits":"1",},
{"lineNum":" 1112","line":"\t\tif duration.as_secs() <= MAX_EXPIRY_TIME {","class":"lineCov","hits":"2","order":"2742","possible_hits":"2",},
{"lineNum":" 1113","line":"\t\t\tOk(ExpiryTime(duration))","class":"lineCov","hits":"1","order":"2743","possible_hits":"1",},
{"lineNum":" 1114","line":"\t\t} else {"},
{"lineNum":" 1115","line":"\t\t\tErr(CreationError::ExpiryTimeOutOfBounds)","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1116","line":"\t\t}"},
{"lineNum":" 1117","line":"\t}","class":"linePartCov","hits":"1","order":"2744","possible_hits":"2",},
{"lineNum":" 1118","line":""},
{"lineNum":" 1119","line":"\t/// Returns the expiry time in seconds"},
{"lineNum":" 1120","line":"\tpub fn as_seconds(&self) -> u64 {","class":"lineCov","hits":"1","order":"2816","possible_hits":"1",},
{"lineNum":" 1121","line":"\t\tself.0.as_secs()","class":"lineCov","hits":"1","order":"2817","possible_hits":"1",},
{"lineNum":" 1122","line":"\t}","class":"linePartCov","hits":"1","order":"2818","possible_hits":"2",},
{"lineNum":" 1123","line":""},
{"lineNum":" 1124","line":"\t/// Returns a reference to the underlying `Duration` (=expiry time)"},
{"lineNum":" 1125","line":"\tpub fn as_duration(&self) -> &Duration {"},
{"lineNum":" 1126","line":"\t\t&self.0"},
{"lineNum":" 1127","line":"\t}"},
{"lineNum":" 1128","line":"}"},
{"lineNum":" 1129","line":""},
{"lineNum":" 1130","line":"impl Route {"},
{"lineNum":" 1131","line":"\t/// Create a new (partial) route from a list of hops"},
{"lineNum":" 1132","line":"\tpub fn new(hops: Vec<RouteHop>) -> Result<Route, CreationError> {"},
{"lineNum":" 1133","line":"\t\tif hops.len() <= 12 {"},
{"lineNum":" 1134","line":"\t\t\tOk(Route(hops))"},
{"lineNum":" 1135","line":"\t\t} else {"},
{"lineNum":" 1136","line":"\t\t\tErr(CreationError::RouteTooLong)"},
{"lineNum":" 1137","line":"\t\t}"},
{"lineNum":" 1138","line":"\t}"},
{"lineNum":" 1139","line":""},
{"lineNum":" 1140","line":"\t/// Returrn the underlying vector of hops"},
{"lineNum":" 1141","line":"\tpub fn into_inner(self) -> Vec<RouteHop> {"},
{"lineNum":" 1142","line":"\t\tself.0"},
{"lineNum":" 1143","line":"\t}"},
{"lineNum":" 1144","line":"}"},
{"lineNum":" 1145","line":""},
{"lineNum":" 1146","line":"impl Into<Vec<RouteHop>> for Route {"},
{"lineNum":" 1147","line":"\tfn into(self) -> Vec<RouteHop> {"},
{"lineNum":" 1148","line":"\t\tself.into_inner()"},
{"lineNum":" 1149","line":"\t}"},
{"lineNum":" 1150","line":"}"},
{"lineNum":" 1151","line":""},
{"lineNum":" 1152","line":"impl Deref for Route {"},
{"lineNum":" 1153","line":"\ttype Target = Vec<RouteHop>;"},
{"lineNum":" 1154","line":""},
{"lineNum":" 1155","line":"\tfn deref(&self) -> &Vec<RouteHop> {","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1156","line":"\t\t&self.0","class":"lineNoCov","hits":"0","possible_hits":"1",},
{"lineNum":" 1157","line":"\t}","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1158","line":"}"},
{"lineNum":" 1159","line":""},
{"lineNum":" 1160","line":"impl Deref for Signature {"},
{"lineNum":" 1161","line":"\ttype Target = RecoverableSignature;"},
{"lineNum":" 1162","line":""},
{"lineNum":" 1163","line":"\tfn deref(&self) -> &RecoverableSignature {","class":"lineCov","hits":"1","order":"2872","possible_hits":"1",},
{"lineNum":" 1164","line":"\t\t&self.0","class":"lineCov","hits":"1","order":"2873","possible_hits":"1",},
{"lineNum":" 1165","line":"\t}","class":"linePartCov","hits":"1","order":"2874","possible_hits":"2",},
{"lineNum":" 1166","line":"}"},
{"lineNum":" 1167","line":""},
{"lineNum":" 1168","line":"impl Deref for SignedRawInvoice {"},
{"lineNum":" 1169","line":"\ttype Target = RawInvoice;"},
{"lineNum":" 1170","line":""},
{"lineNum":" 1171","line":"\tfn deref(&self) -> &RawInvoice {"},
{"lineNum":" 1172","line":"\t\t&self.raw_invoice"},
{"lineNum":" 1173","line":"\t}"},
{"lineNum":" 1174","line":"}"},
{"lineNum":" 1175","line":""},
{"lineNum":" 1176","line":"/// Errors that may occur when constructing a new `RawInvoice` or `Invoice`"},
{"lineNum":" 1177","line":"#[derive(Eq, PartialEq, Debug, Clone)]","class":"lineNoCov","hits":"0","possible_hits":"2",},
{"lineNum":" 1178","line":"pub enum CreationError {"},
{"lineNum":" 1179","line":"\t/// The supplied description string was longer than 639 __bytes__ (see [`Description::new()`](./struct.Description.html#method.new))"},
{"lineNum":" 1180","line":"\tDescriptionTooLong,"},
{"lineNum":" 1181","line":""},
{"lineNum":" 1182","line":"\t/// The specified route has too many hops and can\'t be encoded"},
{"lineNum":" 1183","line":"\tRouteTooLong,"},
{"lineNum":" 1184","line":""},
{"lineNum":" 1185","line":"\t/// The unix timestamp of the supplied date is <0 or can\'t be represented as `SystemTime`"},
{"lineNum":" 1186","line":"\tTimestampOutOfBounds,"},
{"lineNum":" 1187","line":""},
{"lineNum":" 1188","line":"\t/// The supplied expiry time could cause an overflow if added to a `PositiveTimestamp`"},
{"lineNum":" 1189","line":"\tExpiryTimeOutOfBounds,"},
{"lineNum":" 1190","line":"}"},
{"lineNum":" 1191","line":""},
{"lineNum":" 1192","line":"/// Errors that may occur when converting a `RawInvoice` to an `Invoice`. They relate to the"},
{"lineNum":" 1193","line":"/// requirements sections in BOLT #11"},
{"lineNum":" 1194","line":"#[derive(Eq, PartialEq, Debug, Clone)]","class":"lineNoCov","hits":"0","possible_hits":"4",},
{"lineNum":" 1195","line":"pub enum SemanticError {"},
{"lineNum":" 1196","line":"\t/// The invoice is missing the mandatory payment hash"},
{"lineNum":" 1197","line":"\tNoPaymentHash,"},
{"lineNum":" 1198","line":""},
{"lineNum":" 1199","line":"\t/// The invoice has multiple payment hashes which isn\'t allowed"},
{"lineNum":" 1200","line":"\tMultiplePaymentHashes,"},
{"lineNum":" 1201","line":""},
{"lineNum":" 1202","line":"\t/// No description or description hash are part of the invoice"},
{"lineNum":" 1203","line":"\tNoDescription,"},
{"lineNum":" 1204","line":""},
{"lineNum":" 1205","line":"\t/// The invoice contains multiple descriptions and/or description hashes which isn\'t allowed"},
{"lineNum":" 1206","line":"\tMultipleDescriptions,"},
{"lineNum":" 1207","line":""},
{"lineNum":" 1208","line":"\t/// The recovery id doesn\'t fit the signature/pub key"},
{"lineNum":" 1209","line":"\tInvalidRecoveryId,"},
{"lineNum":" 1210","line":""},
{"lineNum":" 1211","line":"\t/// The invoice\'s signature is invalid"},
{"lineNum":" 1212","line":"\tInvalidSignature,"},
{"lineNum":" 1213","line":"}"},
{"lineNum":" 1214","line":""},
{"lineNum":" 1215","line":"/// When signing using a fallible method either an user-supplied `SignError` or a `CreationError`"},
{"lineNum":" 1216","line":"/// may occur."},
{"lineNum":" 1217","line":"#[derive(Eq, PartialEq, Debug, Clone)]"},
{"lineNum":" 1218","line":"pub enum SignOrCreationError<S> {"},
{"lineNum":" 1219","line":"\t/// An error occurred during signing"},
{"lineNum":" 1220","line":"\tSignError(S),"},
{"lineNum":" 1221","line":""},
{"lineNum":" 1222","line":"\t/// An error occurred while building the transaction"},
{"lineNum":" 1223","line":"\tCreationError(CreationError),"},
{"lineNum":" 1224","line":"}"},
{"lineNum":" 1225","line":""},
{"lineNum":" 1226","line":"#[cfg(test)]"},
{"lineNum":" 1227","line":"mod test {"},
{"lineNum":" 1228","line":"\tuse bitcoin_hashes::hex::FromHex;"},
{"lineNum":" 1229","line":"\tuse bitcoin_hashes::{Hash, sha256};"},
{"lineNum":" 1230","line":""},
{"lineNum":" 1231","line":"\t#[test]"},
{"lineNum":" 1232","line":"\tfn test_system_time_bounds_assumptions() {"},
{"lineNum":" 1233","line":"\t\t::check_platform();"},
{"lineNum":" 1234","line":""},
{"lineNum":" 1235","line":"        assert_eq!("},
{"lineNum":" 1236","line":"            ::PositiveTimestamp::from_unix_timestamp(::SYSTEM_TIME_MAX_UNIX_TIMESTAMP + 1),"},
{"lineNum":" 1237","line":"            Err(::CreationError::TimestampOutOfBounds)"},
{"lineNum":" 1238","line":"        );"},
{"lineNum":" 1239","line":""},
{"lineNum":" 1240","line":"        assert_eq!("},
{"lineNum":" 1241","line":"            ::ExpiryTime::from_seconds(::MAX_EXPIRY_TIME + 1),"},
{"lineNum":" 1242","line":"            Err(::CreationError::ExpiryTimeOutOfBounds)"},
{"lineNum":" 1243","line":"        );"},
{"lineNum":" 1244","line":"\t}"},
{"lineNum":" 1245","line":""},
{"lineNum":" 1246","line":"\t#[test]"},
{"lineNum":" 1247","line":"\tfn test_calc_invoice_hash() {"},
{"lineNum":" 1248","line":"\t\tuse ::{RawInvoice, RawHrp, RawDataPart, Currency, PositiveTimestamp};"},
{"lineNum":" 1249","line":"\t\tuse ::TaggedField::*;"},
{"lineNum":" 1250","line":""},
{"lineNum":" 1251","line":"\t\tlet invoice = RawInvoice {"},
{"lineNum":" 1252","line":"\t\t\thrp: RawHrp {"},
{"lineNum":" 1253","line":"\t\t\t\tcurrency: Currency::Bitcoin,"},
{"lineNum":" 1254","line":"\t\t\t\traw_amount: None,"},
{"lineNum":" 1255","line":"\t\t\t\tsi_prefix: None,"},
{"lineNum":" 1256","line":"\t\t\t},"},
{"lineNum":" 1257","line":"\t\t\tdata: RawDataPart {"},
{"lineNum":" 1258","line":"\t\t\t\ttimestamp: PositiveTimestamp::from_unix_timestamp(1496314658).unwrap(),"},
{"lineNum":" 1259","line":"\t\t\t\ttagged_fields: vec!["},
{"lineNum":" 1260","line":"\t\t\t\t\tPaymentHash(::Sha256(sha256::Hash::from_hex("},
{"lineNum":" 1261","line":"\t\t\t\t\t\t\"0001020304050607080900010203040506070809000102030405060708090102\""},
{"lineNum":" 1262","line":"\t\t\t\t\t).unwrap())).into(),"},
{"lineNum":" 1263","line":"\t\t\t\t\tDescription(::Description::new("},
{"lineNum":" 1264","line":"\t\t\t\t\t\t\"Please consider supporting this project\".to_owned()"},
{"lineNum":" 1265","line":"\t\t\t\t\t).unwrap()).into(),"},
{"lineNum":" 1266","line":"\t\t\t\t],"},
{"lineNum":" 1267","line":"\t\t\t},"},
{"lineNum":" 1268","line":"\t\t};"},
{"lineNum":" 1269","line":""},
{"lineNum":" 1270","line":"\t\tlet expected_hash = ["},
{"lineNum":" 1271","line":"\t\t\t0xc3, 0xd4, 0xe8, 0x3f, 0x64, 0x6f, 0xa7, 0x9a, 0x39, 0x3d, 0x75, 0x27, 0x7b, 0x1d,"},
{"lineNum":" 1272","line":"\t\t\t0x85, 0x8d, 0xb1, 0xd1, 0xf7, 0xab, 0x71, 0x37, 0xdc, 0xb7, 0x83, 0x5d, 0xb2, 0xec,"},
{"lineNum":" 1273","line":"\t\t\t0xd5, 0x18, 0xe1, 0xc9"},
{"lineNum":" 1274","line":"\t\t];"},
{"lineNum":" 1275","line":""},
{"lineNum":" 1276","line":"\t\tassert_eq!(invoice.hash(), expected_hash)"},
{"lineNum":" 1277","line":"\t}"},
{"lineNum":" 1278","line":""},
{"lineNum":" 1279","line":"\t#[test]"},
{"lineNum":" 1280","line":"\tfn test_check_signature() {"},
{"lineNum":" 1281","line":"\t\tuse TaggedField::*;"},
{"lineNum":" 1282","line":"\t\tuse secp256k1::{RecoveryId, RecoverableSignature, Secp256k1};"},
{"lineNum":" 1283","line":"\t\tuse secp256k1::key::{SecretKey, PublicKey};"},
{"lineNum":" 1284","line":"\t\tuse {SignedRawInvoice, Signature, RawInvoice, RawHrp, RawDataPart, Currency, Sha256,"},
{"lineNum":" 1285","line":"\t\t\t PositiveTimestamp};"},
{"lineNum":" 1286","line":""},
{"lineNum":" 1287","line":"\t\tlet invoice = SignedRawInvoice {"},
{"lineNum":" 1288","line":"\t\t\traw_invoice: RawInvoice {"},
{"lineNum":" 1289","line":"\t\t\t\thrp: RawHrp {"},
{"lineNum":" 1290","line":"\t\t\t\t\tcurrency: Currency::Bitcoin,"},
{"lineNum":" 1291","line":"\t\t\t\t\traw_amount: None,"},
{"lineNum":" 1292","line":"\t\t\t\t\tsi_prefix: None,"},
{"lineNum":" 1293","line":"\t\t\t\t},"},
{"lineNum":" 1294","line":"\t\t\t\tdata: RawDataPart {"},
{"lineNum":" 1295","line":"\t\t\t\t\ttimestamp: PositiveTimestamp::from_unix_timestamp(1496314658).unwrap(),"},
{"lineNum":" 1296","line":"\t\t\t\t\ttagged_fields: vec ! ["},
{"lineNum":" 1297","line":"\t\t\t\t\t\tPaymentHash(Sha256(sha256::Hash::from_hex("},
{"lineNum":" 1298","line":"\t\t\t\t\t\t\t\"0001020304050607080900010203040506070809000102030405060708090102\""},
{"lineNum":" 1299","line":"\t\t\t\t\t\t).unwrap())).into(),"},
{"lineNum":" 1300","line":"\t\t\t\t\t\tDescription("},
{"lineNum":" 1301","line":"\t\t\t\t\t\t\t::Description::new("},
{"lineNum":" 1302","line":"\t\t\t\t\t\t\t\t\"Please consider supporting this project\".to_owned()"},
{"lineNum":" 1303","line":"\t\t\t\t\t\t\t).unwrap()"},
{"lineNum":" 1304","line":"\t\t\t\t\t\t).into(),"},
{"lineNum":" 1305","line":"\t\t\t\t\t],"},
{"lineNum":" 1306","line":"\t\t\t\t},"},
{"lineNum":" 1307","line":"\t\t\t},"},
{"lineNum":" 1308","line":"\t\t\thash: ["},
{"lineNum":" 1309","line":"\t\t\t\t0xc3, 0xd4, 0xe8, 0x3f, 0x64, 0x6f, 0xa7, 0x9a, 0x39, 0x3d, 0x75, 0x27,"},
{"lineNum":" 1310","line":"\t\t\t\t0x7b, 0x1d, 0x85, 0x8d, 0xb1, 0xd1, 0xf7, 0xab, 0x71, 0x37, 0xdc, 0xb7,"},
{"lineNum":" 1311","line":"\t\t\t\t0x83, 0x5d, 0xb2, 0xec, 0xd5, 0x18, 0xe1, 0xc9"},
{"lineNum":" 1312","line":"\t\t\t],"},
{"lineNum":" 1313","line":"\t\t\tsignature: Signature(RecoverableSignature::from_compact("},
{"lineNum":" 1314","line":"\t\t\t\t& ["},
{"lineNum":" 1315","line":"\t\t\t\t\t0x38u8, 0xec, 0x68, 0x91, 0x34, 0x5e, 0x20, 0x41, 0x45, 0xbe, 0x8a,"},
{"lineNum":" 1316","line":"\t\t\t\t\t0x3a, 0x99, 0xde, 0x38, 0xe9, 0x8a, 0x39, 0xd6, 0xa5, 0x69, 0x43,"},
{"lineNum":" 1317","line":"\t\t\t\t\t0x4e, 0x18, 0x45, 0xc8, 0xaf, 0x72, 0x05, 0xaf, 0xcf, 0xcc, 0x7f,"},
{"lineNum":" 1318","line":"\t\t\t\t\t0x42, 0x5f, 0xcd, 0x14, 0x63, 0xe9, 0x3c, 0x32, 0x88, 0x1e, 0xad,"},
{"lineNum":" 1319","line":"\t\t\t\t\t0x0d, 0x6e, 0x35, 0x6d, 0x46, 0x7e, 0xc8, 0xc0, 0x25, 0x53, 0xf9,"},
{"lineNum":" 1320","line":"\t\t\t\t\t0xaa, 0xb1, 0x5e, 0x57, 0x38, 0xb1, 0x1f, 0x12, 0x7f"},
{"lineNum":" 1321","line":"\t\t\t\t],"},
{"lineNum":" 1322","line":"\t\t\t\tRecoveryId::from_i32(0).unwrap()"},
{"lineNum":" 1323","line":"\t\t\t).unwrap()),"},
{"lineNum":" 1324","line":"\t\t};"},
{"lineNum":" 1325","line":""},
{"lineNum":" 1326","line":"\t\tassert!(invoice.check_signature());"},
{"lineNum":" 1327","line":""},
{"lineNum":" 1328","line":"\t\tlet private_key = SecretKey::from_slice("},
{"lineNum":" 1329","line":"\t\t\t&["},
{"lineNum":" 1330","line":"\t\t\t\t0xe1, 0x26, 0xf6, 0x8f, 0x7e, 0xaf, 0xcc, 0x8b, 0x74, 0xf5, 0x4d, 0x26, 0x9f, 0xe2,"},
{"lineNum":" 1331","line":"\t\t\t\t0x06, 0xbe, 0x71, 0x50, 0x00, 0xf9, 0x4d, 0xac, 0x06, 0x7d, 0x1c, 0x04, 0xa8, 0xca,"},
{"lineNum":" 1332","line":"\t\t\t\t0x3b, 0x2d, 0xb7, 0x34"},
{"lineNum":" 1333","line":"\t\t\t][..]"},
{"lineNum":" 1334","line":"\t\t).unwrap();"},
{"lineNum":" 1335","line":"\t\tlet public_key = PublicKey::from_secret_key(&Secp256k1::new(), &private_key);"},
{"lineNum":" 1336","line":""},
{"lineNum":" 1337","line":"\t\tassert_eq!(invoice.recover_payee_pub_key(), Ok(::PayeePubKey(public_key)));"},
{"lineNum":" 1338","line":""},
{"lineNum":" 1339","line":"\t\tlet (raw_invoice, _, _) = invoice.into_parts();"},
{"lineNum":" 1340","line":"\t\tlet new_signed = raw_invoice.sign::<_, ()>(|hash| {"},
{"lineNum":" 1341","line":"\t\t\tOk(Secp256k1::new().sign_recoverable(hash, &private_key))"},
{"lineNum":" 1342","line":"\t\t}).unwrap();"},
{"lineNum":" 1343","line":""},
{"lineNum":" 1344","line":"\t\tassert!(new_signed.check_signature());"},
{"lineNum":" 1345","line":"\t}"},
{"lineNum":" 1346","line":""},
{"lineNum":" 1347","line":"\t#[test]"},
{"lineNum":" 1348","line":"\tfn test_builder_amount() {"},
{"lineNum":" 1349","line":"\t\tuse ::*;"},
{"lineNum":" 1350","line":""},
{"lineNum":" 1351","line":"\t\tlet builder = InvoiceBuilder::new(Currency::Bitcoin)"},
{"lineNum":" 1352","line":"\t\t\t.description(\"Test\".into())"},
{"lineNum":" 1353","line":"\t\t\t.payment_hash(sha256::Hash::from_slice(&[0;32][..]).unwrap())"},
{"lineNum":" 1354","line":"\t\t\t.current_timestamp();"},
{"lineNum":" 1355","line":""},
{"lineNum":" 1356","line":"\t\tlet invoice = builder.clone()"},
{"lineNum":" 1357","line":"\t\t\t.amount_pico_btc(15000)"},
{"lineNum":" 1358","line":"\t\t\t.build_raw()"},
{"lineNum":" 1359","line":"\t\t\t.unwrap();"},
{"lineNum":" 1360","line":""},
{"lineNum":" 1361","line":"\t\tassert_eq!(invoice.hrp.si_prefix, Some(SiPrefix::Nano));"},
{"lineNum":" 1362","line":"\t\tassert_eq!(invoice.hrp.raw_amount, Some(15));"},
{"lineNum":" 1363","line":""},
{"lineNum":" 1364","line":""},
{"lineNum":" 1365","line":"\t\tlet invoice = builder.clone()"},
{"lineNum":" 1366","line":"\t\t\t.amount_pico_btc(1500)"},
{"lineNum":" 1367","line":"\t\t\t.build_raw()"},
{"lineNum":" 1368","line":"\t\t\t.unwrap();"},
{"lineNum":" 1369","line":""},
{"lineNum":" 1370","line":"\t\tassert_eq!(invoice.hrp.si_prefix, Some(SiPrefix::Pico));"},
{"lineNum":" 1371","line":"\t\tassert_eq!(invoice.hrp.raw_amount, Some(1500));"},
{"lineNum":" 1372","line":"\t}"},
{"lineNum":" 1373","line":""},
{"lineNum":" 1374","line":"\t#[test]"},
{"lineNum":" 1375","line":"\tfn test_builder_fail() {"},
{"lineNum":" 1376","line":"\t\tuse ::*;"},
{"lineNum":" 1377","line":"\t\tuse std::iter::FromIterator;"},
{"lineNum":" 1378","line":"\t\tuse secp256k1::key::PublicKey;"},
{"lineNum":" 1379","line":""},
{"lineNum":" 1380","line":"\t\tlet builder = InvoiceBuilder::new(Currency::Bitcoin)"},
{"lineNum":" 1381","line":"\t\t\t.payment_hash(sha256::Hash::from_slice(&[0;32][..]).unwrap())"},
{"lineNum":" 1382","line":"\t\t\t.current_timestamp();"},
{"lineNum":" 1383","line":""},
{"lineNum":" 1384","line":"\t\tlet too_long_string = String::from_iter("},
{"lineNum":" 1385","line":"\t\t\t(0..1024).map(|_| \'?\')"},
{"lineNum":" 1386","line":"\t\t);"},
{"lineNum":" 1387","line":""},
{"lineNum":" 1388","line":"\t\tlet long_desc_res = builder.clone()"},
{"lineNum":" 1389","line":"\t\t\t.description(too_long_string)"},
{"lineNum":" 1390","line":"\t\t\t.build_raw();"},
{"lineNum":" 1391","line":"\t\tassert_eq!(long_desc_res, Err(CreationError::DescriptionTooLong));"},
{"lineNum":" 1392","line":""},
{"lineNum":" 1393","line":"\t\tlet route_hop = RouteHop {"},
{"lineNum":" 1394","line":"\t\t\tpubkey: PublicKey::from_slice("},
{"lineNum":" 1395","line":"\t\t\t\t\t&["},
{"lineNum":" 1396","line":"\t\t\t\t\t\t0x03, 0x9e, 0x03, 0xa9, 0x01, 0xb8, 0x55, 0x34, 0xff, 0x1e, 0x92, 0xc4,"},
{"lineNum":" 1397","line":"\t\t\t\t\t\t0x3c, 0x74, 0x43, 0x1f, 0x7c, 0xe7, 0x20, 0x46, 0x06, 0x0f, 0xcf, 0x7a,"},
{"lineNum":" 1398","line":"\t\t\t\t\t\t0x95, 0xc3, 0x7e, 0x14, 0x8f, 0x78, 0xc7, 0x72, 0x55"},
{"lineNum":" 1399","line":"\t\t\t\t\t][..]"},
{"lineNum":" 1400","line":"\t\t\t\t).unwrap(),"},
{"lineNum":" 1401","line":"\t\t\tshort_channel_id: [0; 8],"},
{"lineNum":" 1402","line":"\t\t\tfee_base_msat: 0,"},
{"lineNum":" 1403","line":"\t\t\tfee_proportional_millionths: 0,"},
{"lineNum":" 1404","line":"\t\t\tcltv_expiry_delta: 0,"},
{"lineNum":" 1405","line":"\t\t};"},
{"lineNum":" 1406","line":"\t\tlet too_long_route = vec![route_hop; 13];"},
{"lineNum":" 1407","line":"\t\tlet long_route_res = builder.clone()"},
{"lineNum":" 1408","line":"\t\t\t.description(\"Test\".into())"},
{"lineNum":" 1409","line":"\t\t\t.route(too_long_route)"},
{"lineNum":" 1410","line":"\t\t\t.build_raw();"},
{"lineNum":" 1411","line":"\t\tassert_eq!(long_route_res, Err(CreationError::RouteTooLong));"},
{"lineNum":" 1412","line":""},
{"lineNum":" 1413","line":"\t\tlet sign_error_res = builder.clone()"},
{"lineNum":" 1414","line":"\t\t\t.description(\"Test\".into())"},
{"lineNum":" 1415","line":"\t\t\t.try_build_signed(|_| {"},
{"lineNum":" 1416","line":"\t\t\t\tErr(\"ImaginaryError\")"},
{"lineNum":" 1417","line":"\t\t\t});"},
{"lineNum":" 1418","line":"\t\tassert_eq!(sign_error_res, Err(SignOrCreationError::SignError(\"ImaginaryError\")));"},
{"lineNum":" 1419","line":"\t}"},
{"lineNum":" 1420","line":""},
{"lineNum":" 1421","line":"\t#[test]"},
{"lineNum":" 1422","line":"\tfn test_builder_ok() {"},
{"lineNum":" 1423","line":"\t\tuse ::*;"},
{"lineNum":" 1424","line":"\t\tuse secp256k1::Secp256k1;"},
{"lineNum":" 1425","line":"\t\tuse secp256k1::key::{SecretKey, PublicKey};"},
{"lineNum":" 1426","line":"\t\tuse std::time::{UNIX_EPOCH, Duration};"},
{"lineNum":" 1427","line":""},
{"lineNum":" 1428","line":"\t\tlet secp_ctx = Secp256k1::new();"},
{"lineNum":" 1429","line":""},
{"lineNum":" 1430","line":"\t\tlet private_key = SecretKey::from_slice("},
{"lineNum":" 1431","line":"\t\t\t&["},
{"lineNum":" 1432","line":"\t\t\t\t0xe1, 0x26, 0xf6, 0x8f, 0x7e, 0xaf, 0xcc, 0x8b, 0x74, 0xf5, 0x4d, 0x26, 0x9f, 0xe2,"},
{"lineNum":" 1433","line":"\t\t\t\t0x06, 0xbe, 0x71, 0x50, 0x00, 0xf9, 0x4d, 0xac, 0x06, 0x7d, 0x1c, 0x04, 0xa8, 0xca,"},
{"lineNum":" 1434","line":"\t\t\t\t0x3b, 0x2d, 0xb7, 0x34"},
{"lineNum":" 1435","line":"\t\t\t][..]"},
{"lineNum":" 1436","line":"\t\t).unwrap();"},
{"lineNum":" 1437","line":"\t\tlet public_key = PublicKey::from_secret_key(&secp_ctx, &private_key);"},
{"lineNum":" 1438","line":""},
{"lineNum":" 1439","line":"\t\tlet route_1 = vec!["},
{"lineNum":" 1440","line":"\t\t\tRouteHop {"},
{"lineNum":" 1441","line":"\t\t\t\tpubkey: public_key.clone(),"},
{"lineNum":" 1442","line":"\t\t\t\tshort_channel_id: [123; 8],"},
{"lineNum":" 1443","line":"\t\t\t\tfee_base_msat: 2,"},
{"lineNum":" 1444","line":"\t\t\t\tfee_proportional_millionths: 1,"},
{"lineNum":" 1445","line":"\t\t\t\tcltv_expiry_delta: 145,"},
{"lineNum":" 1446","line":"\t\t\t},"},
{"lineNum":" 1447","line":"\t\t\tRouteHop {"},
{"lineNum":" 1448","line":"\t\t\t\tpubkey: public_key.clone(),"},
{"lineNum":" 1449","line":"\t\t\t\tshort_channel_id: [42; 8],"},
{"lineNum":" 1450","line":"\t\t\t\tfee_base_msat: 3,"},
{"lineNum":" 1451","line":"\t\t\t\tfee_proportional_millionths: 2,"},
{"lineNum":" 1452","line":"\t\t\t\tcltv_expiry_delta: 146,"},
{"lineNum":" 1453","line":"\t\t\t}"},
{"lineNum":" 1454","line":"\t\t];"},
{"lineNum":" 1455","line":""},
{"lineNum":" 1456","line":"\t\tlet route_2 = vec!["},
{"lineNum":" 1457","line":"\t\t\tRouteHop {"},
{"lineNum":" 1458","line":"\t\t\t\tpubkey: public_key.clone(),"},
{"lineNum":" 1459","line":"\t\t\t\tshort_channel_id: [0; 8],"},
{"lineNum":" 1460","line":"\t\t\t\tfee_base_msat: 4,"},
{"lineNum":" 1461","line":"\t\t\t\tfee_proportional_millionths: 3,"},
{"lineNum":" 1462","line":"\t\t\t\tcltv_expiry_delta: 147,"},
{"lineNum":" 1463","line":"\t\t\t},"},
{"lineNum":" 1464","line":"\t\t\tRouteHop {"},
{"lineNum":" 1465","line":"\t\t\t\tpubkey: public_key.clone(),"},
{"lineNum":" 1466","line":"\t\t\t\tshort_channel_id: [1; 8],"},
{"lineNum":" 1467","line":"\t\t\t\tfee_base_msat: 5,"},
{"lineNum":" 1468","line":"\t\t\t\tfee_proportional_millionths: 4,"},
{"lineNum":" 1469","line":"\t\t\t\tcltv_expiry_delta: 148,"},
{"lineNum":" 1470","line":"\t\t\t}"},
{"lineNum":" 1471","line":"\t\t];"},
{"lineNum":" 1472","line":""},
{"lineNum":" 1473","line":"\t\tlet builder = InvoiceBuilder::new(Currency::BitcoinTestnet)"},
{"lineNum":" 1474","line":"\t\t\t.amount_pico_btc(123)"},
{"lineNum":" 1475","line":"\t\t\t.timestamp(UNIX_EPOCH + Duration::from_secs(1234567))"},
{"lineNum":" 1476","line":"\t\t\t.payee_pub_key(public_key.clone())"},
{"lineNum":" 1477","line":"\t\t\t.expiry_time(Duration::from_secs(54321))"},
{"lineNum":" 1478","line":"\t\t\t.min_final_cltv_expiry(144)"},
{"lineNum":" 1479","line":"\t\t\t.min_final_cltv_expiry(143)"},
{"lineNum":" 1480","line":"\t\t\t.fallback(Fallback::PubKeyHash([0;20]))"},
{"lineNum":" 1481","line":"\t\t\t.route(route_1.clone())"},
{"lineNum":" 1482","line":"\t\t\t.route(route_2.clone())"},
{"lineNum":" 1483","line":"\t\t\t.description_hash(sha256::Hash::from_slice(&[3;32][..]).unwrap())"},
{"lineNum":" 1484","line":"\t\t\t.payment_hash(sha256::Hash::from_slice(&[21;32][..]).unwrap());"},
{"lineNum":" 1485","line":""},
{"lineNum":" 1486","line":"\t\tlet invoice = builder.clone().build_signed(|hash| {"},
{"lineNum":" 1487","line":"\t\t\tsecp_ctx.sign_recoverable(hash, &private_key)"},
{"lineNum":" 1488","line":"\t\t}).unwrap();"},
{"lineNum":" 1489","line":""},
{"lineNum":" 1490","line":"\t\tassert!(invoice.check_signature().is_ok());"},
{"lineNum":" 1491","line":"\t\tassert_eq!(invoice.tagged_fields().count(), 9);"},
{"lineNum":" 1492","line":""},
{"lineNum":" 1493","line":"\t\tassert_eq!(invoice.amount_pico_btc(), Some(123));"},
{"lineNum":" 1494","line":"\t\tassert_eq!(invoice.currency(), Currency::BitcoinTestnet);"},
{"lineNum":" 1495","line":"\t\tassert_eq!("},
{"lineNum":" 1496","line":"\t\t\tinvoice.timestamp().duration_since(UNIX_EPOCH).unwrap().as_secs(),"},
{"lineNum":" 1497","line":"\t\t\t1234567"},
{"lineNum":" 1498","line":"\t\t);"},
{"lineNum":" 1499","line":"\t\tassert_eq!(invoice.payee_pub_key(), Some(&public_key));"},
{"lineNum":" 1500","line":"\t\tassert_eq!(invoice.expiry_time(), Some(&Duration::from_secs(54321)));"},
{"lineNum":" 1501","line":"\t\tassert_eq!(invoice.min_final_cltv_expiry(), Some(&144));"},
{"lineNum":" 1502","line":"\t\tassert_eq!(invoice.fallbacks(), vec![&Fallback::PubKeyHash([0;20])]);"},
{"lineNum":" 1503","line":"\t\tassert_eq!(invoice.routes(), vec![&Route(route_1), &Route(route_2)]);"},
{"lineNum":" 1504","line":"\t\tassert_eq!("},
{"lineNum":" 1505","line":"\t\t\tinvoice.description(),"},
{"lineNum":" 1506","line":"\t\t\tInvoiceDescription::Hash(&Sha256(sha256::Hash::from_slice(&[3;32][..]).unwrap()))"},
{"lineNum":" 1507","line":"\t\t);"},
{"lineNum":" 1508","line":"\t\tassert_eq!(invoice.payment_hash(), &sha256::Hash::from_slice(&[21;32][..]).unwrap());"},
{"lineNum":" 1509","line":""},
{"lineNum":" 1510","line":"\t\tlet raw_invoice = builder.build_raw().unwrap();"},
{"lineNum":" 1511","line":"\t\tassert_eq!(raw_invoice, *invoice.into_signed_raw().raw_invoice())"},
{"lineNum":" 1512","line":"\t}"},
{"lineNum":" 1513","line":"}"},
]};
var percent_low = 25;var percent_high = 75;
var header = { "command" : "ser_de-ab20411a83224715", "date" : "2019-06-01 07:50:29", "instrumented" : 293, "covered" : 237,};
var merged_data = [];
